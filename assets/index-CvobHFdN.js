import{r as N,_ as Z,E as _,O as ee,a as te,c as se,k as ae,h as oe}from"./index-reG5_0Rm.js";import{E as le}from"./el-pagination-Cbn4UHlx.js";import{E as ne}from"./el-color-picker-Dn2TPk05.js";import{E as re}from"./el-progress-C2HcI4BS.js";import{a as ce}from"./axios-xsH4HHeE.js";import{r as i,z as ie,A as D,q as de,s as B,N as s,S as c,ah as w,Q as v,u as L,bv as ue,O as M,P as pe,L as ve,ai as me,X as _e}from"./vue-vendor-BgjGt3mC.js";import"./lodash-BmZg10rb.js";import"./jszip-C7-yN4-L.js";import"./remark-CBsncvHK.js";import"./quill-BeGMbSWh.js";import"./position-CrPvG4RE.js";const fe=async g=>N({url:"/video/convert/list",method:"get",params:g}),he=async g=>N({url:"/video/convert",method:"post",data:g}),ge={class:"convert-container"},be={class:"content-wrapper"},ke={class:"layout-container"},ye={class:"left-column"},we={class:"card upload-card"},xe={class:"card-content"},Ce={class:"card setting-card"},Ee={class:"card-content"},Se={class:"hsv-selector"},Te={class:"color-controls"},Ve={class:"right-column"},Pe={class:"card result-card"},Ue={class:"card-content"},Fe={class:"table-container"},Re=["onClick"],ze={__name:"index",setup(g){const $="/api/",V=i(!0),x=i(1),P=i(20),U=i(0),b=i(30);ie(()=>{q()});const q=async()=>{S()},k=i([]),f=i([]),C=i("#FFFF00"),H=async t=>["video/mp4"].includes(t.type)?!0:(_.error("只能上传 MP4类型的视频"),!1),E=i(0),I=async t=>{const{file:e,onProgress:a,onSuccess:n,onError:r}=t;new FormData().append("file",e),e.uploadStatus="uploading";const o=new FormData;o.append("file",e);try{const u=await ce.post("/api/file/upload/oss",o,{onUploadProgress:p=>{const m=Math.round(p.loaded*100/p.total);a({percent:m})}});u.data.code==0?(f.value.push(u.data.data.file_id),e.uploadStatus="success",_.success("上传成功!")):(e.uploadStatus="error",_.error("上传失败!"))}catch{_.error("上传失败!")}},O=t=>{E.value=t.percent},F=i(0),R=i(0),W=()=>{R.value++,E.value=0},A=()=>{E.value=0},Q=(t,e)=>{F.value=e.length},X=(t,e)=>{f.value=e},j=async()=>{const t={video_ids:f.value,hue_shift:b.value,saturation_scale:1,brightness_offset:0};try{const e=await he(t);if(e.code===0)_.success("转换中..."),f.value=[],S();else throw new Error(e.message)}catch(e){throw new Error(e)}},S=async()=>{let e=0;const a={page:x.value,pagesize:P.value};z(e,5e3,a)};let h=i(null);const z=async(t,e,a)=>{try{const n=await fe(a);if(n.code===0){const r=n.data;k.value=r.list,k.value.forEach(o=>{switch(o.status){case"success":o.statusRes="成功";break;case"waiting":o.statusRes="转换中...";break;case"failed":o.statusRes="失败";break;default:o.statusRes="-"}o.time=o.create_time.replace("T"," ")}),U.value=r.count,k.value.some(o=>o.status==="waiting")?h.value=setTimeout(()=>z(t,e,a),e):h.value=null}else{_.error("发生错误，请稍后重试!");return}}catch{_.error("发生错误，请稍后重试!");return}},G=t=>{x.value=t,h.value&&(clearTimeout(h.value),h.value=null),S()},J=t=>{const e=document.createElement("a");e.href=$+t.converted_video.video_url,e.download=`${t.converted_video.video_name}.mp4`,document.body.appendChild(e),e.click(),document.body.removeChild(e)};D(b,t=>{const e=t/179*360,r=K(e/360,1,1);C.value=r}),D(R,t=>{F.value==t&&(V.value=!1)});const K=(t,e,a)=>{let n,r,d;const o=Math.floor(t*6),u=t*6-o,p=a*(1-e),m=a*(1-u*e),l=a*(1-(1-u)*e);switch(o%6){case 0:n=a,r=l,d=p;break;case 1:n=m,r=a,d=p;break;case 2:n=p,r=a,d=l;break;case 3:n=p,r=m,d=a;break;case 4:n=l,r=p,d=a;break;case 5:n=a,r=p,d=m;break}const y=Y=>{const T=Math.round(Y*255).toString(16);return T.length===1?"0"+T:T};return`#${y(n)}${y(r)}${y(d)}`};return(t,e)=>{const a=ae,n=te,r=re,d=ne,o=ee,u=oe,p=se,m=le;return B(),de("div",ge,[s("div",be,[e[9]||(e[9]=s("div",{class:"page-header"},[s("h2",{class:"text-[20px] font-medium text-[#333] flex items-center"}," 视频颜色转换 ")],-1)),s("div",ke,[s("div",ye,[s("div",we,[s("div",xe,[e[3]||(e[3]=s("h2",{class:"card-title"},[w(" 上传视频"),s("span",{class:"remind_style"}," （支持mp4格式） ")],-1)),c(r,{class:"custom-upload",action:"#","http-request":I,"before-upload":H,"on-progress":O,"on-remove":X,"on-change":Q,"on-success":W,"on-error":A,accept:"video/* ",multiple:""},{default:v(()=>[c(n,{type:"primary",class:"upload-btn"},{default:v(()=>[c(a,{class:"upload-icon"},{default:v(()=>[c(L(ue))]),_:1}),e[2]||(e[2]=w("上传视频 "))]),_:1,__:[2]})]),_:1})])]),s("div",Ce,[s("div",Ee,[e[6]||(e[6]=s("h2",{class:"card-title"},"颜色设置",-1)),s("div",Se,[e[4]||(e[4]=s("div",{class:"hsv-label"},"HSV色相选择:",-1)),s("div",Te,[c(d,{class:"readonly-color-picker",ref:"colorPickerRef",modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=l=>C.value=l),size:"large"},null,8,["modelValue"]),c(o,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=l=>b.value=l),min:0,max:179,class:"hsv-slider","show-input":""},null,8,["modelValue"])])]),c(n,{type:"primary",onClick:j,disabled:f.value.length==0||V.value,class:"convert-btn"},{default:v(()=>e[5]||(e[5]=[w("开始转换")])),_:1,__:[5]},8,["disabled"])])])]),s("div",Ve,[s("div",Pe,[s("div",Ue,[e[8]||(e[8]=s("h2",{class:"card-title"},"转换结果",-1)),s("div",Fe,[c(p,{data:k.value,stripe:"",class:"custom-table"},{default:v(()=>[c(u,{prop:"origin_video.video_name",label:"视频名称",width:"220px","show-overflow-tooltip":""}),c(u,{prop:"status",label:"状态",width:"110",align:"center"},{default:v(({row:l})=>[s("span",{class:M([{"text-red":l.status==="failed","text-blue":l.status==="waiting","text-green":l.status==="success"},"status-text"])},[l.status==="waiting"?(B(),pe(a,{key:0,class:"is-loading"},{default:v(()=>[c(L(me))]),_:1})):ve("",!0),w(_e(l.statusRes),1)],2)]),_:1}),c(u,{label:"操作",width:"80",align:"center"},{default:v(({row:l})=>[s("a",{class:M(["download-link",{disabled:l.status!=="success"}]),onClick:y=>l.status==="success"&&J(l)},e[7]||(e[7]=[s("span",{class:"download-text"},"下载",-1)]),10,Re)]),_:1}),c(u,{prop:"time",label:"创建时间","min-width":"140"})]),_:1},8,["data"])]),c(m,{onCurrentChange:G,"current-page":x.value,"page-size":P.value,layout:"prev, pager, next",total:U.value,class:"custom-pagination"},null,8,["current-page","page-size","total"])])])])])])])}}},Ae=Z(ze,[["__scopeId","data-v-6bee30c2"]]);export{Ae as default};
//# sourceMappingURL=index-CvobHFdN.js.map
