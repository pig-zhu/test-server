import{T as Me,U as Ze,V as Ge,W as Ne,X as ut,Y as ct,k as oe,Z as dt,$ as he,a0 as ft,a1 as vt,a2 as pt,a3 as Qe,_ as Pe,a4 as et,d as mt,r as De,s as Fe,a5 as tt,a6 as gt,a7 as yt,E as pe,a as _t,f as ht,a8 as bt}from"./index-D7mwCrnB.js";import{E as wt,a as kt}from"./el-tab-pane-BCKgZa4a.js";import{E as Oe}from"./el-card-zedNbdDm.js";/* empty css                          */import{E as xt}from"./el-date-picker-BVWuB4X7.js";import{k as Be,n as Ce,_ as Ye,o as we,b1 as je,bt as Et,bw as Lt,r as w,bx as Ct,D as St,c as Y,A as ge,z as at,E as be,P as U,s as c,Q as x,S as y,a3 as It,N as o,Y as Re,O as A,u as n,L as T,q as E,t as Q,U as Tt,ap as $t,M as le,b6 as Dt,as as Vt,ah as te,X as J,by as zt,bs as Mt,R as st,bz as Rt,bA as At,aM as Ie,F as $e,w as Ue,G as Nt,e as Ee,b as Pt,v as Ke,aB as Ot,aV as Xe,aW as Je,a as Bt,bB as Yt,bC as qe,bD as Ut,bE as Ht,bF as Ft,l as jt,$ as Kt,a4 as lt,a0 as Xt,a1 as de,I as Jt,a2 as Le,at as qt,au as Wt}from"./vue-vendor-BgjGt3mC.js";import{v as Zt}from"./el-loading-B11eFGmQ.js";import{E as Gt}from"./el-divider-BFeg4wsn.js";import{t as Se,f as Qt,n as ea}from"./lodash-BmZg10rb.js";import{i as ta,g as aa}from"./position-CrPvG4RE.js";import{E as sa}from"./index-BZMJx0qS.js";import"./axios-xsH4HHeE.js";import"./jszip-C7-yN4-L.js";import"./remark-CBsncvHK.js";import"./quill-BeGMbSWh.js";const la=Be({urlList:{type:Ce(Array),default:()=>Ze([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:Ce(String)}}),na={close:()=>!0,switch:s=>Me(s),rotate:s=>Me(s)},oa=we({name:"ElImageViewer"}),ia=we({...oa,props:la,emits:na,setup(s,{expose:S,emit:v}){var p;const r=s,d={CONTAIN:{name:"contain",icon:je(Lt)},ORIGINAL:{name:"original",icon:je(Et)}};let L,I="";const{t:b}=Ge(),i=Ne("image-viewer"),{nextZIndex:_}=ut(),C=w(),M=w([]),N=Ct(),V=w(!0),k=w(r.initialIndex),R=St(d.CONTAIN),$=w({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),q=w((p=r.zIndex)!=null?p:_()),K=Y(()=>{const{urlList:e}=r;return e.length<=1}),ie=Y(()=>k.value===0),P=Y(()=>k.value===r.urlList.length-1),a=Y(()=>r.urlList[k.value]),ae=Y(()=>[i.e("btn"),i.e("prev"),i.is("disabled",!r.infinite&&ie.value)]),O=Y(()=>[i.e("btn"),i.e("next"),i.is("disabled",!r.infinite&&P.value)]),ne=Y(()=>{const{scale:e,deg:g,offsetX:t,offsetY:m,enableTransition:B}=$.value;let F=t/e,Z=m/e;const ve=g*Math.PI/180,xe=Math.cos(ve),Te=Math.sin(ve);F=F*xe+Z*Te,Z=Z*xe-t/e*Te;const z={transform:`scale(${e}) rotate(${g}deg) translate(${F}px, ${Z}px)`,transition:B?"transform .3s":""};return R.value.name===d.CONTAIN.name&&(z.maxWidth=z.maxHeight="100%"),z}),j=Y(()=>`${k.value+1} / ${r.urlList.length}`);function ee(){ue(),L==null||L(),document.body.style.overflow=I,v("close")}function re(){const e=Se(t=>{switch(t.code){case he.esc:r.closeOnPressEscape&&ee();break;case he.space:W();break;case he.left:ce();break;case he.up:se("zoomIn");break;case he.right:ke();break;case he.down:se("zoomOut");break}}),g=Se(t=>{const m=t.deltaY||t.deltaX;se(m<0?"zoomIn":"zoomOut",{zoomRate:r.zoomRate,enableTransition:!1})});N.run(()=>{be(document,"keydown",e),be(document,"wheel",g)})}function ue(){N.stop()}function fe(){V.value=!1}function X(e){V.value=!1,e.target.alt=b("el.image.error")}function u(e){if(V.value||e.button!==0||!C.value)return;$.value.enableTransition=!1;const{offsetX:g,offsetY:t}=$.value,m=e.pageX,B=e.pageY,F=Se(ve=>{$.value={...$.value,offsetX:g+ve.pageX-m,offsetY:t+ve.pageY-B}}),Z=be(document,"mousemove",F);be(document,"mouseup",()=>{Z()}),e.preventDefault()}function H(){$.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function W(){if(V.value)return;const e=ft(d),g=Object.values(d),t=R.value.name,B=(g.findIndex(F=>F.name===t)+1)%e.length;R.value=d[e[B]],H()}function ye(e){const g=r.urlList.length;k.value=(e+g)%g}function ce(){ie.value&&!r.infinite||ye(k.value-1)}function ke(){P.value&&!r.infinite||ye(k.value+1)}function se(e,g={}){if(V.value)return;const{minScale:t,maxScale:m}=r,{zoomRate:B,rotateDeg:F,enableTransition:Z}={zoomRate:r.zoomRate,rotateDeg:90,enableTransition:!0,...g};switch(e){case"zoomOut":$.value.scale>t&&($.value.scale=Number.parseFloat(($.value.scale/B).toFixed(3)));break;case"zoomIn":$.value.scale<m&&($.value.scale=Number.parseFloat(($.value.scale*B).toFixed(3)));break;case"clockwise":$.value.deg+=F,v("rotate",$.value.deg);break;case"anticlockwise":$.value.deg-=F,v("rotate",$.value.deg);break}$.value.enableTransition=Z}function f(e){var g;((g=e.detail)==null?void 0:g.focusReason)==="pointer"&&e.preventDefault()}function l(){r.closeOnPressEscape&&ee()}function h(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}return ge(a,()=>{$e(()=>{const e=M.value[0];e!=null&&e.complete||(V.value=!0)})}),ge(k,e=>{H(),v("switch",e)}),at(()=>{re(),L=be("wheel",h,{passive:!1}),I=document.body.style.overflow,document.body.style.overflow="hidden"}),S({setActiveItem:ye}),(e,g)=>(c(),U(n(dt),{to:"body",disabled:!e.teleported},{default:x(()=>[y(It,{name:"viewer-fade",appear:""},{default:x(()=>[o("div",{ref_key:"wrapper",ref:C,tabindex:-1,class:A(n(i).e("wrapper")),style:Re({zIndex:q.value})},[y(n(ct),{loop:"",trapped:"","focus-trap-el":C.value,"focus-start-el":"container",onFocusoutPrevented:f,onReleaseRequested:l},{default:x(()=>[o("div",{class:A(n(i).e("mask")),onClick:Tt(t=>e.hideOnClickModal&&ee(),["self"])},null,10,["onClick"]),T(" CLOSE "),o("span",{class:A([n(i).e("btn"),n(i).e("close")]),onClick:ee},[y(n(oe),null,{default:x(()=>[y(n($t))]),_:1})],2),T(" ARROW "),n(K)?T("v-if",!0):(c(),E(le,{key:0},[o("span",{class:A(n(ae)),onClick:ce},[y(n(oe),null,{default:x(()=>[y(n(Dt))]),_:1})],2),o("span",{class:A(n(O)),onClick:ke},[y(n(oe),null,{default:x(()=>[y(n(Vt))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(c(),E("div",{key:1,class:A([n(i).e("btn"),n(i).e("progress")])},[Q(e.$slots,"progress",{activeIndex:k.value,total:e.urlList.length},()=>[te(J(n(j)),1)])],2)):T("v-if",!0),T(" ACTIONS "),o("div",{class:A([n(i).e("btn"),n(i).e("actions")])},[o("div",{class:A(n(i).e("actions__inner"))},[Q(e.$slots,"toolbar",{actions:se,prev:ce,next:ke,reset:W,activeIndex:k.value,setActiveItem:ye},()=>[y(n(oe),{onClick:t=>se("zoomOut")},{default:x(()=>[y(n(zt))]),_:1},8,["onClick"]),y(n(oe),{onClick:t=>se("zoomIn")},{default:x(()=>[y(n(Mt))]),_:1},8,["onClick"]),o("i",{class:A(n(i).e("actions__divider"))},null,2),y(n(oe),{onClick:W},{default:x(()=>[(c(),U(st(n(R).icon)))]),_:1}),o("i",{class:A(n(i).e("actions__divider"))},null,2),y(n(oe),{onClick:t=>se("anticlockwise")},{default:x(()=>[y(n(Rt))]),_:1},8,["onClick"]),y(n(oe),{onClick:t=>se("clockwise")},{default:x(()=>[y(n(At))]),_:1},8,["onClick"])])],2)],2),T(" CANVAS "),o("div",{class:A(n(i).e("canvas"))},[(c(!0),E(le,null,Ie(e.urlList,(t,m)=>(c(),E(le,{key:m},[m===k.value?(c(),E("img",{key:0,ref_for:!0,ref:B=>M.value[m]=B,src:t,style:Re(n(ne)),class:A(n(i).e("img")),crossorigin:e.crossorigin,onLoad:fe,onError:X,onMousedown:u},null,46,["src","crossorigin"])):T("v-if",!0)],64))),128))],2),Q(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var ra=Ye(ia,[["__file","image-viewer.vue"]]);const nt=Ue(ra),ua=Be({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:Ce([String,Object])},previewSrcList:{type:Ce(Array),default:()=>Ze([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:Ce(String)}}),ca={load:s=>s instanceof Event,error:s=>s instanceof Event,switch:s=>Me(s),close:()=>!0,show:()=>!0},da=we({name:"ElImage",inheritAttrs:!1}),fa=we({...da,props:ua,emits:ca,setup(s,{expose:S,emit:v}){const p=s,{t:r}=Ge(),d=Ne("image"),L=Nt(),I=Y(()=>Qt(Object.entries(L).filter(([u])=>/^(data-|on[A-Z])/i.test(u)||["id","style"].includes(u)))),b=vt({excludeListeners:!0,excludeKeys:Y(()=>Object.keys(I.value))}),i=w(),_=w(!1),C=w(!0),M=w(!1),N=w(),V=w(),k=Ee&&"loading"in HTMLImageElement.prototype;let R;const $=Y(()=>[d.e("inner"),K.value&&d.e("preview"),C.value&&d.is("loading")]),q=Y(()=>{const{fit:u}=p;return Ee&&u?{objectFit:u}:{}}),K=Y(()=>{const{previewSrcList:u}=p;return Pt(u)&&u.length>0}),ie=Y(()=>{const{previewSrcList:u,initialIndex:H}=p;let W=H;return H>u.length-1&&(W=0),W}),P=Y(()=>p.loading==="eager"?!1:!k&&p.loading==="lazy"||p.lazy),a=()=>{Ee&&(C.value=!0,_.value=!1,i.value=p.src)};function ae(u){C.value=!1,_.value=!1,v("load",u)}function O(u){C.value=!1,_.value=!0,v("error",u)}function ne(){ta(N.value,V.value)&&(a(),re())}const j=Yt(ne,200,!0);async function ee(){var u;if(!Ee)return;await $e();const{scrollContainer:H}=p;pt(H)?V.value=H:Bt(H)&&H!==""?V.value=(u=document.querySelector(H))!=null?u:void 0:N.value&&(V.value=Qe(N.value)),V.value&&(R=be(V,"scroll",j),setTimeout(()=>ne(),100))}function re(){!Ee||!V.value||!j||(R==null||R(),V.value=void 0)}function ue(){K.value&&(M.value=!0,v("show"))}function fe(){M.value=!1,v("close")}function X(u){v("switch",u)}return ge(()=>p.src,()=>{P.value?(C.value=!0,_.value=!1,re(),ee()):a()}),at(()=>{P.value?ee():a()}),S({showPreview:ue}),(u,H)=>(c(),E("div",Ke({ref_key:"container",ref:N},n(I),{class:[n(d).b(),u.$attrs.class]}),[_.value?Q(u.$slots,"error",{key:0},()=>[o("div",{class:A(n(d).e("error"))},J(n(r)("el.image.error")),3)]):(c(),E(le,{key:1},[i.value!==void 0?(c(),E("img",Ke({key:0},n(b),{src:i.value,loading:u.loading,style:n(q),class:n($),crossorigin:u.crossorigin,onClick:ue,onLoad:ae,onError:O}),null,16,["src","loading","crossorigin"])):T("v-if",!0),C.value?(c(),E("div",{key:1,class:A(n(d).e("wrapper"))},[Q(u.$slots,"placeholder",{},()=>[o("div",{class:A(n(d).e("placeholder"))},null,2)])],2)):T("v-if",!0)],64)),n(K)?(c(),E(le,{key:2},[M.value?(c(),U(n(nt),{key:0,"z-index":u.zIndex,"initial-index":n(ie),infinite:u.infinite,"zoom-rate":u.zoomRate,"min-scale":u.minScale,"max-scale":u.maxScale,"show-progress":u.showProgress,"url-list":u.previewSrcList,crossorigin:u.crossorigin,"hide-on-click-modal":u.hideOnClickModal,teleported:u.previewTeleported,"close-on-press-escape":u.closeOnPressEscape,onClose:fe,onSwitch:X},Ot({toolbar:x(W=>[Q(u.$slots,"toolbar",Xe(Je(W)))]),default:x(()=>[u.$slots.viewer?(c(),E("div",{key:0},[Q(u.$slots,"viewer")])):T("v-if",!0)]),_:2},[u.$slots.progress?{name:"progress",fn:x(W=>[Q(u.$slots,"progress",Xe(Je(W)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):T("v-if",!0)],64)):T("v-if",!0)],16))}});var va=Ye(fa,[["__file","image.vue"]]);const pa=Ue(va),me={primary:"icon-primary",success:"icon-success",warning:"icon-warning",error:"icon-error",info:"icon-info"},We={[me.primary]:qe,[me.success]:Ft,[me.warning]:Ht,[me.error]:Ut,[me.info]:qe},ma=Be({title:{type:String,default:""},subTitle:{type:String,default:""},icon:{type:String,values:["primary","success","warning","info","error"],default:"info"}}),ga=we({name:"ElResult"}),ya=we({...ga,props:ma,setup(s){const S=s,v=Ne("result"),p=Y(()=>{const r=S.icon,d=r&&me[r]?me[r]:"icon-info",L=We[d]||We["icon-info"];return{class:d,component:L}});return(r,d)=>(c(),E("div",{class:A(n(v).b())},[o("div",{class:A(n(v).e("icon"))},[Q(r.$slots,"icon",{},()=>[n(p).component?(c(),U(st(n(p).component),{key:0,class:A(n(p).class)},null,8,["class"])):T("v-if",!0)])],2),r.title||r.$slots.title?(c(),E("div",{key:0,class:A(n(v).e("title"))},[Q(r.$slots,"title",{},()=>[o("p",null,J(r.title),1)])],2)):T("v-if",!0),r.subTitle||r.$slots["sub-title"]?(c(),E("div",{key:1,class:A(n(v).e("subtitle"))},[Q(r.$slots,"sub-title",{},()=>[o("p",null,J(r.subTitle),1)])],2)):T("v-if",!0),r.$slots.extra?(c(),E("div",{key:2,class:A(n(v).e("extra"))},[Q(r.$slots,"extra")],2)):T("v-if",!0)],2))}});var _a=Ye(ya,[["__file","result.vue"]]);const ha=Ue(_a),G="ElInfiniteScroll",ba=50,wa=200,ka=0,xa={delay:{type:Number,default:wa},distance:{type:Number,default:ka},disabled:{type:Boolean,default:!1},immediate:{type:Boolean,default:!0}},He=(s,S)=>Object.entries(xa).reduce((v,[p,r])=>{var d,L;const{type:I,default:b}=r,i=s.getAttribute(`infinite-scroll-${p}`);let _=(L=(d=S[i])!=null?d:i)!=null?L:b;return _=_==="false"?!1:_,_=I(_),v[p]=Number.isNaN(_)?b:_,v},{}),ot=s=>{const{observer:S}=s[G];S&&(S.disconnect(),delete s[G].observer)},Ea=(s,S)=>{const{container:v,containerEl:p,instance:r,observer:d,lastScrollTop:L}=s[G],{disabled:I,distance:b}=He(s,r),{clientHeight:i,scrollHeight:_,scrollTop:C}=p,M=C-L;if(s[G].lastScrollTop=C,d||I||M<0)return;let N=!1;if(v===s)N=_-(i+C)<=b;else{const{clientTop:V,scrollHeight:k}=s,R=aa(s,p);N=C+i>=R+V+k-b}N&&S.call(r)};function Ve(s,S){const{containerEl:v,instance:p}=s[G],{disabled:r}=He(s,p);r||v.clientHeight===0||(v.scrollHeight<=v.clientHeight?S.call(p):ot(s))}const La={async mounted(s,S){const{instance:v,value:p}=S;jt(p)||Kt(G,"'v-infinite-scroll' binding value must be a function"),await $e();const{delay:r,immediate:d}=He(s,v),L=Qe(s,!0),I=L===window?document.documentElement:L,b=Se(Ea.bind(null,s,p),r);if(L){if(s[G]={instance:v,container:L,containerEl:I,delay:r,cb:p,onScroll:b,lastScrollTop:I.scrollTop},d){const i=new MutationObserver(Se(Ve.bind(null,s,p),ba));s[G].observer=i,i.observe(s,{childList:!0,subtree:!0}),Ve(s,p)}L.addEventListener("scroll",b)}},unmounted(s){if(!s[G])return;const{container:S,onScroll:v}=s[G];S==null||S.removeEventListener("scroll",v),ot(s)},async updated(s){if(!s[G])await $e();else{const{containerEl:S,cb:v,observer:p}=s[G];S.clientHeight&&p&&Ve(s,v)}}},Ae=La;Ae.install=s=>{s.directive("InfiniteScroll",Ae)};const Ca=Ae,Sa={class:"video-container"},Ia={class:"video-list"},Ta=["onClick"],$a={key:0,class:"loading"},Da={class:"video-info"},Va=["src"],za={__name:"VideoPlayerModal",setup(s,{expose:S}){const v=w([]),p=w(),r=w(""),d=w(0),L=w(!1),I=w(""),b=(C,M,N)=>{L.value=!0,v.value=C,r.value=C[M].viewUrl,d.value=M,N?I.value="预览视频-"+N:I.value="预览视频"},i=()=>{var C;L.value=!1,(C=p.value)==null||C.pause()},_=C=>{d.value=C,r.value=v.value[C].viewUrl};return S({open:b}),(C,M)=>{const N=Oe,V=mt;return c(),U(V,{modelValue:L.value,"onUpdate:modelValue":M[0]||(M[0]=k=>L.value=k),title:I.value,width:"1000","before-close":i},{default:x(()=>[o("div",Sa,[y(N,{style:{"border-radius":"12px",width:"400px"}},{default:x(()=>[o("div",Ia,[(c(!0),E(le,null,Ie(v.value,(k,R)=>(c(),E("div",{class:A(["video-item",{active:d.value===R}]),key:R,onClick:$=>_(R)},[o("div",{class:"thumbnail",style:Re({background:`url(${k.url}) 100%/100%`})},[d.value===R?(c(),E("div",$a,M[1]||(M[1]=[o("div",{class:"load"},null,-1),o("div",{class:"load"},null,-1),o("div",{class:"load"},null,-1),o("div",{class:"load"},null,-1),o("div",{class:"load"},null,-1)]))):T("",!0)],4),o("div",Da,[o("span",null,J(k.name),1),o("span",null,J(k.duration?n(et)(k.duration):"暂无"),1)])],10,Ta))),128))])]),_:1}),(c(),E("div",{class:"video-player",key:r.value},[o("video",{controls:"",ref_key:"videoRef",ref:p},[o("source",{src:r.value,type:"video/mp4"},null,8,Va),M[2]||(M[2]=te(" 您的浏览器不支持 video 标签。 "))],512)]))])]),_:1},8,["modelValue","title"])}}},Ma=Pe(za,[["__scopeId","data-v-b608b439"]]),Ra=async s=>De({url:"/material/fetch/jd_material",method:"get",showToast:!0,params:s}),ze=async(s,S={})=>De({url:"/material/fetch/jd/list",method:"get",showToast:!0,params:s,...S}),Aa=async s=>De({url:"/material/fetch/keyword_material",method:"get",showToast:!0,params:s}),Na=async s=>De({url:"/material/fetch/material_lib/upload",method:"get",showToast:!0,params:s}),Pa=["infinite-scroll-disabled"],Oa={class:"data-item"},Ba={class:"flex items-center justify-between text-[18px]"},Ya={key:0,class:"infinite-list"},Ua={class:"flex flex-col items-center justify-center gap-[10px]"},Ha=["onClick"],Fa=["onClick"],ja={class:"video-info flex justify-between items-center"},Ka={class:"flex gap-[3px] items-center",style:{color:"var(--el-color-danger-light-5)"}},Xa={class:"tip"},Ja={key:1},qa={key:0,class:"text-center text-[12px] text-gray-400"},Wa='<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="var(--el-color-primary)" d="M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32m0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32m448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32m-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32M195.2 195.2a32 32 0 0 1 45.248 0L376.32 331.008a32 32 0 0 1-45.248 45.248L195.2 240.448a32 32 0 0 1 0-45.248zm452.544 452.544a32 32 0 0 1 45.248 0L828.8 783.552a32 32 0 0 1-45.248 45.248L647.744 692.992a32 32 0 0 1 0-45.248zM828.8 195.264a32 32 0 0 1 0 45.184L692.992 376.32a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0m-452.544 452.48a32 32 0 0 1 0 45.248L240.448 828.8a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0z"></path></svg>',Za={__name:"RenderData",props:{type:{type:Number,default:1}},emits:["handleSelect"],setup(s,{expose:S,emit:v}){const p=new Map,r=v,d=s,L="/api/",I=w(),b=w([]),i=lt({page:1,pageSize:5,dropLoading:!1,noMore:!1}),_=w([]),C=w(!1),M=w(!1),N=w([]),V=w(0),k=w(null),R=w(null),$=w(null);let q=null;const K=Y(()=>_.value.some(f=>f.status==="processing")),ie=Y(()=>i.dropLoading||i.noMore),P=(f,l,h,e)=>{if(f.stopPropagation(),l.items[h].type==="video"){const g=l.items.filter(m=>m.type==="video"),t=g.findIndex(m=>m.id===e);I.value.open(g,t,l.title)}else{const g=l.items.filter(t=>t.type==="image");N.value=g.map(t=>t.url),V.value=g.findIndex(t=>t.id===e),M.value=!0}},a=(f,l,h)=>{l?b.value.push({id:f.id,url:f.viewUrl}):(b.value=b.value.filter(e=>e.id!==f.id),h.selectedAll=!1),h.items.every(e=>!!b.value.find(g=>g.id===e.id))&&(h.selectedAll=!0)},ae=(f,l)=>{l.items&&l.items.length&&(f?l.items.forEach(h=>{h.selected||b.value.push({id:h.id,url:h.viewUrl}),h.selected=!0}):(l.selectedAll=!1,l.items.forEach(h=>{h.selected=!1,b.value=b.value.filter(e=>e.id!==h.id)})))},O=()=>{b.value=[],_.value.forEach(f=>{ae(!1,f)})},ne=ea.debounce(async()=>{i.dropLoading=!0,i.page++,await j(!1),i.dropLoading=!1},100),j=async(f=!0,l)=>{f&&(C.value=!0),q&&q.abort(),q=new AbortController;let h=[];switch(d.type){case 1:h=await ee(l,{signal:q.signal});break;case 2:h=await re(l,{signal:q.signal});break;case 3:h=await fe(l,{signal:q.signal});break}return h.length?K.value||!ke(_.value,h)?_.value=await H([...h]):_.value=await H([..._.value,...h]):i.noMore=!0,C.value=!1,K.value&&!k.value&&(k.value=setTimeout(()=>{i.page=1,j(!1),clearTimeout(k.value),k.value=null},3e3)),h},ee=async(f,l)=>(await ze({...i,...f,task_type:2},l)).data.list,re=async(f,l)=>(await ze({...i,...f,task_type:1},l)).data.list,ue=async f=>{const l=await Ra(f);pe.success(l.data.message||"任务已提交"),!(l.data.message&&l.data.message.includes("已存在"))&&(ce(),j())},fe=async(f,l)=>(await ze({...i,...f,task_type:3},l)).data.list,X=async f=>{const l=await Aa(f);pe.success(l.data.message||"任务已提交"),!(l.data.message&&l.data.message.includes("已存在"))&&(ce(),j())},u=f=>f>99999999?(f/1e8).toFixed(2)+"亿":f>9999?(f/1e4).toFixed(2)+"万":f,H=async f=>{const l=async(e,g,t)=>{if(e.type==="video"){const m=p.get(e.url);m?(e.url=m.url,e.duration=m.duration):(W(e.url,g,t,d.type),e.url="",e.duration="")}return e};return await Promise.all(f.map(async(e,g)=>{const t={...e};return d.type==1?t.title=Fe(t.create_time).format("YYYY-MM-DD"):d.type==2?t.product_info?t.title=`sku: ${t.product_info.sku_id}   标题: ${t.product_info.product_short_name||"-"}`:(t.title=`sku: ${t.post_id}   标题: 任务生成失败`,t.errorMsg=`${t.error_message||"接口错误"}`):d.type==3&&(t.title=`关键词: ${t.post_id}   时间: ${Fe(t.create_time).format("YYYY-MM-DD")}`),t.items&&t.items.length&&(t.items=await Promise.all(t.items.map(async(m,B)=>{const F={id:m.id,name:m.file_name,type:m.file_type,url:L+m.file_url,viewUrl:L+m.file_url,description:null,size:m.size_mb,like:m.like_count,orientation:m.video_orientation};return b.value&&b.value.length&&(F.selected=b.value.some(Z=>Z.id===m.id)),await l(F,g,B)})),t.items.every(m=>!!b.value.find(B=>B.id===m.id))?t.selectedAll=!0:t.selectedAll=!1),t}))},W=(f,l,h,e)=>{const g={duration:null,url:null},t=document.createElement("video");t.crossOrigin="anonymous",t.preload="metadata",t.src=f,t.addEventListener("loadeddata",()=>{d.type===e&&(t.currentTime=.1,g.duration=t.duration,_.value[l]&&_.value[l].items[h]&&(_.value[l].items[h].duration=t.duration))}),t.addEventListener("seeked",()=>{if(d.type===e){const m=document.createElement("canvas");$.value?(m.width=$.value.width,m.height=280):(m.width=180,m.height=280),m.getContext("2d").drawImage(t,0,0,m.width,m.height),g.url=m.toDataURL("image/jpeg"),_.value[l]&&_.value[l].items[h]&&(_.value[l].items[h].url=g.url),p.set(f,g)}})},ye=()=>{M.value=!1,N.value=[],V.value=0},ce=()=>{_.value=[],K.value=!1,i.dropLoading=!1,i.page=1,i.noMore=!1,clearTimeout(k.value),k.value=null},ke=(f,l)=>{if(f.length!==l.length)return!1;const h=f.length;for(let e=0;e<h;e++){const g=f[e],t=l[e];if(g.status!==t.status||g.id!==t.id)return!1}return!0},se=async()=>{const f={item_ids:b.value.map(l=>l.id).join(",")};try{const l=await Na(f);l.code===0?pe.success("保存成功"):pe.error(l.message||"保存失败")}catch(l){pe.error(l||"保存失败")}};return Xt(()=>{k.value&&clearTimeout(k.value)}),ge(()=>b.value.length,()=>{r("handleSelect",b.value)}),ge(()=>d.type,()=>{O(),ce(),j()},{immediate:!0}),ge(R,()=>{if(R.value&&R.value[0]){const f=R.value[0].getBoundingClientRect();$.value={width:f.width,heigth:f.heigth}}}),S({clearSelected:O,getData:j,RunJdData:ue,resetData:ce,dataList:_,RunKeyData:X,transferToSmartMixLibrary:se}),(f,l)=>{const h=tt,e=gt,g=pa,t=oe,m=ha,B=yt,F=Gt,Z=Oe,ve=nt,xe=Zt,Te=Ca;return c(),E("div",null,[de((c(),U(Z,{class:"mt-3 ml-2 data-list","element-loading-text":"正在加载..."},{default:x(()=>[_.value.length?de((c(),E("ul",{key:0,"infinite-scroll-distance":10,"infinite-scroll-disabled":ie.value,style:{"padding-bottom":"20px"}},[(c(!0),E(le,null,Ie(_.value,(z,it)=>(c(),E("li",{key:z.id},[o("div",Oa,[o("div",Ba,[o("span",null,J(z.title),1),z.items&&z.items.length?(c(),U(h,{key:0,onChange:D=>ae(z.selectedAll,z),modelValue:z.selectedAll,"onUpdate:modelValue":D=>z.selectedAll=D,label:"全选"},null,8,["onChange","modelValue","onUpdate:modelValue"])):T("",!0)]),z.status==="processing"||z.status==="completed"?(c(),E(le,{key:0},[z.items&&z.items.length?(c(),E("div",Ya,[(c(!0),E(le,null,Ie(z.items,(D,rt)=>(c(),E("div",{class:"card-box flex-auto overflow-hidden",key:D.id},[o("div",{class:"text-[16px] font-semibold h-full flex items-center bg-[#bbb]",ref_for:!0,ref_key:"imageBoxRef",ref:R},[D.type==="video"?(c(),U(g,{key:0,class:"w-[100%] h-fit",src:D.url,lazy:""},{error:x(()=>[o("div",Ua,[y(e,{class:"w-[26px] h-[26px]"}),l[0]||(l[0]=o("p",{class:"text-[12px] text-[#fff]"},"图片加载中...",-1))])]),_:2},1032,["src"])):(c(),U(g,{key:1,class:"w-[100%]",alt:"加载失败",src:D.url,lazy:""},null,8,["src"]))],512),o("div",{class:"operation",onClick:_e=>{_e.target.localName==="div"&&(D.selected=!D.selected),a(D,D.selected,z)}},[o("div",{class:"operation-icon",onClick:_e=>P(_e,z,rt,D.id)},[y(t,{size:20},{default:x(()=>[y(n(Jt))]),_:1}),o("div",null,J(D.type==="video"?"查看视频":"查看图片"),1)],8,Fa)],8,Ha),o("div",{class:A(["operation-select",{"operation-selected":D.selected}])},[y(h,{onChange:_e=>a(D,D.selected,z),modelValue:D.selected,"onUpdate:modelValue":_e=>D.selected=_e},null,8,["onChange","modelValue","onUpdate:modelValue"])],2),o("div",ja,[de(o("span",null,J(n(et)(D.duration)),513),[[Le,D.duration]]),de(o("div",Ka,[o("span",null,J(u(D.like)),1),l[1]||(l[1]=o("svg",{class:"icon",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24"},[o("path",{d:"M20 8h-5.612l1.123-3.367c.202-.608.1-1.282-.275-1.802S14.253 2 13.612 2H12c-.297 0-.578.132-.769.36L6.531 8H4c-1.103 0-2 .897-2 2v9c0 1.103.897 2 2 2h13.307a2.01 2.01 0 0 0 1.873-1.298l2.757-7.351A1 1 0 0 0 22 12v-2c0-1.103-.897-2-2-2zM4 10h2v9H4v-9zm16 1.819L17.307 19H8V9.362L12.468 4h1.146l-1.562 4.683A.998.998 0 0 0 13 10h7v1.819z"})],-1))],512),[[Le,D.like]]),de(o("span",null,J(D.size),513),[[Le,D.size]])]),de(o("div",Xa,[o("span",null,J(D.orientation==="portrait"?"竖屏":"横屏"),1)],512),[[Le,D.type==="video"]])]))),128))])):T("",!0),z.status==="processing"?(c(),U(m,{key:1,icon:"success",style:{"background-color":"#f8f8f8"}},{title:x(()=>l[2]||(l[2]=[o("span",null,"正在处理...",-1)])),icon:x(()=>[y(e,{class:"w-[26px] h-[26px]"})]),_:1})):T("",!0),z.status==="completed"&&(!z.items||!z.items.length)?(c(),U(B,{key:2,description:"暂无数据"})):T("",!0)],64)):(c(),E("div",Ja,[y(m,{icon:"error",title:"抱歉，任务生成失败","sub-title":z.error_message},{extra:x(()=>l[3]||(l[3]=[])),_:2},1032,["sub-title"])]))]),it!==_.value.length-1?(c(),U(F,{key:0})):T("",!0)]))),128)),de(o("li",{class:"mt-3","element-loading-text":"加载中...","element-loading-spinner":Wa},null,512),[[xe,i.dropLoading]]),i.noMore?(c(),E("li",qa,"没有更多啦~")):T("",!0)],8,Pa)),[[Te,n(ne)]]):(c(),U(B,{key:1,description:"暂无数据"}))]),_:1})),[[xe,C.value]]),y(Ma,{ref_key:"VideoPlayerModalRef",ref:I},null,512),M.value?(c(),U(ve,{key:0,"url-list":N.value,"initial-index":V.value,infinite:!1,onClose:ye},null,8,["url-list","initial-index"])):T("",!0)])}}},Ga=Pe(Za,[["__scopeId","data-v-8f3aa204"]]),Qa={class:"material-container w-full h-full p-10 overflow-y-auto"},es={class:"flex gap-[20px] text-[14px] items-center justify-between flex-wrap"},ts={class:"flex gap-[12px] items-center"},as={key:0,class:"flex gap-[12px] items-center"},ss={key:1,class:"flex gap-[12px] items-center"},ls={class:"selectBox"},ns={class:"flex items-center gap-[12px] justify-end mr-[20px]"},os={class:"text-[#61f11c] font-semibold text-[16px]"},is={__name:"index",setup(s){const S=[{id:1,name:"解压视频"},{id:2,name:"京东SKU图片视频获取"},{id:3,name:"关键词获取"}],v=w(S[0].id),p=w(""),r=w(""),d=w([]),L=w([2,3]),I=w(),b=w([]),i=lt({date:""}),_=[{text:"今天",value:()=>[new Date,new Date]},{text:"上周",value:()=>{const P=new Date,a=new Date;return a.setTime(a.getTime()-3600*1e3*24*7),[a,P]}},{text:"上月",value:()=>{const P=new Date,a=new Date;return a.setTime(a.getTime()-3600*1e3*24*30),[a,P]}}],C=P=>P.getTime()>Date.now(),M=P=>{d.value=P},N=async()=>{d.value.map(a=>a.url).forEach((a,ae)=>{const O=document.createElement("a");O.href=a,O.download=!0,O.style.display="none",document.body.appendChild(O),O.click(),document.body.removeChild(O),setTimeout(()=>{},100*ae)})},V=()=>{let P=p.value.trim();if(P.length===0){b.value=[];return}b.value=P.match(/\d+(?:\.\d+)?/g)||[]},k=()=>{sa.confirm(Wt("div",`识别到有效sku ${b.value.length} 条, 是否确认？`),"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(()=>{I.value.RunJdData({sku_id:b.value.join(",")})}).catch(()=>{})},R=()=>{L.value.length?I.value.RunKeyData({key_word:r.value,platform:L.value.join(",")}):pe.warning("平台至少选择一个！")},$=()=>i.date&&i.date.length?{start_date:i.date[0],end_date:i.date[1]}:null,q=()=>{pe.warning("暂未开发！")},K=w(!1),ie=()=>{I.value&&(K.value=!0,I.value.transferToSmartMixLibrary().finally(()=>{K.value=!1}))};return ge(v,()=>{p.value="",r.value="",b.value=[],i.date=null}),(P,a)=>{const ae=xt,O=_t,ne=ht,j=tt,ee=bt,re=Oe,ue=kt,fe=wt;return c(),E("div",Qa,[y(fe,{modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=X=>v.value=X)},{default:x(()=>[(c(),E(le,null,Ie(S,X=>y(ue,{key:X.id,label:X.name,name:X.id},{default:x(()=>[y(re,{class:"mt-3 ml-2"},{default:x(()=>[o("div",es,[o("div",ts,[a[8]||(a[8]=o("span",null,"筛选项:",-1)),a[9]||(a[9]=o("span",null,"日期:",-1)),y(ae,{modelValue:i.date,"onUpdate:modelValue":a[0]||(a[0]=u=>i.date=u),type:"daterange","unlink-panels":"","start-placeholder":"开始日期","end-placeholder":"截止日期",shortcuts:_,"value-format":"YYYY-MM-DD",disabledDate:C},null,8,["modelValue"]),y(O,{type:"primary",onClick:a[1]||(a[1]=()=>{I.value.resetData(),I.value.getData(!0,$(i.date))})},{default:x(()=>a[7]||(a[7]=[te("筛选")])),_:1,__:[7]})]),X.id===2?(c(),E("div",as,[a[11]||(a[11]=o("span",null,"sku:",-1)),y(ne,{modelValue:p.value,"onUpdate:modelValue":a[2]||(a[2]=u=>p.value=u),style:{width:"250px"},placeholder:"请输入sku",clearable:"",onChange:V},null,8,["modelValue"]),y(O,{type:"primary",onClick:k,disabled:!p.value},{default:x(()=>a[10]||(a[10]=[te("运行")])),_:1,__:[10]},8,["disabled"])])):T("",!0),X.id===3?(c(),E("div",ss,[a[13]||(a[13]=o("span",null,"平台:",-1)),y(ee,{modelValue:L.value,"onUpdate:modelValue":a[3]||(a[3]=u=>L.value=u)},{default:x(()=>[y(j,{label:"抖音",value:3}),y(j,{label:"小红书",value:2})]),_:1},8,["modelValue"]),a[14]||(a[14]=o("span",{class:"ml-2"},"关键词:",-1)),y(ne,{modelValue:r.value,"onUpdate:modelValue":a[4]||(a[4]=u=>r.value=u),onKeyup:qt(R,["enter"]),style:{width:"240px"},clearable:"",placeholder:"请输入"},null,8,["modelValue"]),y(O,{type:"primary",onClick:R,disabled:!r.value},{default:x(()=>a[12]||(a[12]=[te("运行")])),_:1,__:[12]},8,["disabled"])])):T("",!0)])]),_:2},1024)]),_:2},1032,["label","name"])),64)),y(Ga,{ref_key:"renderDataRef",ref:I,onHandleSelect:M,type:v.value},null,8,["type"])]),_:1},8,["modelValue"]),de(o("div",ls,[o("div",ns,[o("div",null,[a[15]||(a[15]=te(" 已选择 ")),o("span",os,J(d.value.length),1),a[16]||(a[16]=te(" 项 "))]),y(O,{type:"warning",link:"",disabled:!d.value.length,onClick:a[6]||(a[6]=()=>{d.value=[],I.value.clearSelected()})},{default:x(()=>a[17]||(a[17]=[te(" 取消选择 ")])),_:1,__:[17]},8,["disabled"]),y(O,{type:"primary",onClick:N,disabled:!d.value.length},{default:x(()=>a[18]||(a[18]=[te("打包下载")])),_:1,__:[18]},8,["disabled"]),v.value===1?(c(),U(O,{key:0,disabled:!d.value.length,onClick:q},{default:x(()=>a[19]||(a[19]=[te("保存至小说快剪")])),_:1,__:[19]},8,["disabled"])):T("",!0),v.value===2?(c(),U(O,{key:1,disabled:!d.value.length,loading:K.value,onClick:ie},{default:x(()=>a[20]||(a[20]=[te("保存至智能混剪")])),_:1,__:[20]},8,["disabled","loading"])):T("",!0)])],512),[[Le,d.value.length]])])}}},xs=Pe(is,[["__scopeId","data-v-89b1d58a"]]);export{xs as default};
//# sourceMappingURL=index-BEoaASac.js.map
