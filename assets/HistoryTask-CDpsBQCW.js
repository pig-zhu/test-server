import{_ as Qe,f as Xe,a as Ge,k as ea,a7 as aa,d as ta,E as P}from"./index-reG5_0Rm.js";import{v as sa}from"./el-loading-BO2IY38M.js";import{E as la}from"./el-pagination-Cbn4UHlx.js";import{E as na}from"./el-date-picker-DSpEvlof.js";import{r as y,a4 as O,c as ee,a5 as ia,z as be,a0 as ke,q as p,s as v,N as s,S as m,L as R,a1 as oa,at as ra,u as E,M as ae,aM as ce,O as de,X as w,ch as ca,bK as da,P as ue,Q as C,ai as ua,ah as ga,bq as Ee,ap as ze,U as te,b6 as va,as as ma}from"./vue-vendor-BgjGt3mC.js";import{a as De}from"./axios-xsH4HHeE.js";import"./lodash-BmZg10rb.js";import"./jszip-C7-yN4-L.js";import"./remark-CBsncvHK.js";import"./quill-BeGMbSWh.js";const pa={class:"history-task-container"},ha={class:"history-layout"},fa={class:"left-panel"},_a={class:"filters-section"},wa={class:"filter-item"},ya={class:"filter-item"},Ca={class:"time-options"},Ia=["onClick"],Pa={class:"filter-item date-picker-container"},Sa={class:"date-picker-wrapper"},ba={class:"stats-section"},ka={class:"stats-cards"},Ea={class:"stat-card"},za={class:"stat-value"},Da={class:"stat-card"},Ta={class:"stat-value"},xa={class:"stat-card"},La={class:"stat-value"},Ra={class:"stat-card"},$a={class:"stat-value"},Ma={class:"right-panel"},Fa={class:"results-header"},Na={class:"results-title"},Aa={key:0,class:"image-gallery"},Oa={class:"task-header"},Va={class:"task-name"},Ua={class:"task-meta"},Ha={class:"task-time"},Ba={class:"task-preview"},Wa=["src","data-task-id","alt","onClick"],Ya={key:0,class:"image-loading-placeholder"},qa={key:1,class:"image-counter"},ja={key:1,class:"no-images-placeholder"},Ka={key:1},Ja={key:1,class:"no-tasks"},Za={key:0,class:"pagination-container"},Qa={class:"pagination-inner"},Xa={class:"preview-dialog-header"},Ga={class:"preview-title"},et={class:"preview-actions"},at={key:0,class:"image-count-badge"},tt={class:"preview-container"},st={key:0,class:"image-gallery-dialog"},lt=["src","data-task-id","data-index","onClick"],nt={key:0,class:"image-loading-placeholder"},it={class:"image-info"},ot={class:"image-number"},rt={key:0,class:"image-ratio"},ct={key:1,class:"no-images"},dt={key:2,class:"dialog-pagination-container"},ut={class:"full-image-container"},gt=["src"],vt={class:"full-preview-number"},mt={class:"full-preview-controls"},Te="/api/ai",ge=30*60*1e3,pt={__name:"HistoryTask",setup(ht){const k=y(!1),se=y(!1);y("暂无历史任务");const z=y(""),_=y("all"),xe=[{label:"全部",value:"all"},{label:"今天",value:"today"},{label:"近7天",value:"7days"}],h=y([]);y(!1);const x=O({totalImages:0,todayImages:0,weekImages:0,monthImages:0}),g=y([]),i=O({all:[],today:[],"7days":[],dateRange:{range:[],tasks:[]},lastFetchTime:0}),F=y(!1),c=y(null),Le=y(null),V=y(!1),U=y(null),S=y(0),d=O({pageSize:10,currentPage:1,total:0}),f=O({currentPage:1,pageSizes:[8,12,20,32],pageSize:12}),H=ee(()=>f.pageSize),le=()=>{const e=window.innerWidth;e<640?f.pageSize=6:e<1024?f.pageSize=9:e<1440?f.pageSize=12:f.pageSize=20},ve=e=>!e||!e.width||!e.height?!1:e.width/e.height<.8,ne=ee(()=>{if(g.value.length===0)return d.total=0,[];let e=g.value;if(z.value&&z.value.trim()!==""){const u=z.value.trim().toLowerCase();e=e.filter(r=>r.taskName&&r.taskName.toLowerCase().includes(u)||r.prompt&&r.prompt.toLowerCase().includes(u)?!0:r.images&&r.images.length>0&&r.images[0].prompt?r.images[0].prompt.toLowerCase().includes(u):!1)}d.total=e.length;const a=Math.max(1,Math.ceil(e.length/d.pageSize));d.currentPage>a&&(d.currentPage=a);const t=(d.currentPage-1)*d.pageSize,o=t+d.pageSize;if(o<e.length){const u=e.slice(o,Math.min(o+d.pageSize,e.length));setTimeout(()=>{u.forEach(r=>{if(r.images&&r.images.length>0){const I=new Image;I.src=b(r.images[0].url)}})},500)}return e.slice(t,o)}),ie=new Map,me=e=>{if(!e)return"";if(ie.has(e))return ie.get(e);const a=new Date(e),t=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`;return ie.set(e,t),t},pe=(e,a)=>{let t=null;return function(){t&&clearTimeout(t),t=setTimeout(()=>{e.apply(this,arguments)},a)}},W=pe(()=>{d.currentPage=1},300),he=async()=>{k.value=!0,i.lastFetchTime=0,await N(!0),P.success("数据已刷新"),k.value=!1},Y=e=>Date.now()-i.lastFetchTime<ge&&(e==="all"&&i.all.length>0||e==="today"&&i.today.length>0||e==="7days"&&i["7days"].length>0||e==="dateRange"&&i.dateRange.tasks.length>0&&q(i.dateRange.range,h.value)),q=(e,a)=>!e||!a||e.length!==a.length?!1:e.every((t,o)=>t===a[o]),Re=(e,a=50)=>new Promise(t=>{const o=e.length,u=[];let r=0;const I=T=>{const A=Math.min(T+a,o),X=e.slice(T,A),G=X.map(n=>(n.images||(n.images=[]),n.preview_image&&(Array.isArray(n.images)||(n.images=[]),n.images.some(L=>L.id===n.preview_image.id)||n.images.push(n.preview_image)),Array.isArray(n.images)||(n.images=[n.images]),n.created_at&&!n.createTime&&(n.createTime=n.created_at),n.task_id&&!n.id&&(n.id=n.task_id),n.imageCount=n.image_count||n.images.length,n.images&&n.images.length>0&&n.images.forEach(L=>{L&&L.url&&b(L.url)}),n.name?n.taskName=Ie(n.name):n.taskName?n.taskName=Ie(n.taskName):n.prompt?n.taskName=n.prompt:n.preview_image&&n.preview_image.prompt?n.taskName=n.preview_image.prompt:n.images&&n.images.length>0&&n.images[0].prompt?n.taskName=n.images[0].prompt:n.taskName="未命名任务",n));u.push(...G),r+=X.length,r<o?window.requestAnimationFrame(()=>I(A)):t(u)};I(0)}),N=async(e=!1)=>{try{se.value=!0;let a="all";if(_.value!=="all"?a=_.value:h.value&&h.value.length===2&&(a="dateRange"),!e&&Y(a)){a==="dateRange"?g.value=[...i.dateRange.tasks]:g.value=[...i[a]],d.total=g.value.length,d.currentPage=1,j(),se.value=!1;return}k.value=!0;const t=new URLSearchParams;if(t.append("limit","200"),t.append("offset","0"),_.value!=="all"){const r=new Date;if(r.setHours(0,0,0,0),_.value==="today"){const I=r.toISOString().split("T")[0];t.append("start_date",fe(0))}else _.value==="7days"&&(new Date(r).setDate(r.getDate()-7),t.append("start_date",fe(7)))}else h.value&&h.value.length===2&&(t.append("start_date",h.value[0]),t.append("end_date",h.value[1]));const o=()=>{setTimeout(()=>{k.value&&o()},2e3)};o();const u=await De.get(`${Te}/history?${t.toString()}`);if(u.data.success)if(u.data.tasks&&Array.isArray(u.data.tasks)){const r=await Re(u.data.tasks);_.value!=="all"?i[_.value]=r:h.value&&h.value.length===2?i.dateRange={range:[...h.value],tasks:r}:i.all=r,i.lastFetchTime=Date.now(),g.value=r,d.total=r.length,d.currentPage=1,j()}else g.value=u.data.tasks||[],d.total=g.value.length;else P.error(u.data.error||"获取历史记录失败")}catch(a){console.error("获取历史任务失败:",a),P.error("获取历史任务失败，请检查网络连接")}finally{k.value=!1,se.value=!1}},fe=e=>{const a=new Date;return a.setDate(a.getDate()-e),a.setHours(0,0,0,0),me(a)},j=async()=>{try{const e=await De.get(`${Te}/history/stats`);e.data.success&&(x.totalImages=e.data.stats.totalImages,x.todayImages=e.data.stats.todayImages,x.weekImages=e.data.stats.weekImages,x.monthImages=e.data.stats.monthImages)}catch(e){console.error("获取统计数据失败:",e)}},$e=e=>{d.currentPage=e},Me=e=>{d.pageSize=e,d.currentPage=1},Fe=()=>{},Ne=e=>{e!==_.value&&(_.value=e,d.currentPage=1,h.value=[],Y(e)?(g.value=[...i[e]],d.total=g.value.length):N())},Ae=e=>{e&&e.length===2?(_.value="all",h.value=e,d.currentPage=1,Y("dateRange")&&q(i.dateRange.range,e)?(g.value=[...i.dateRange.tasks],d.total=g.value.length):N()):e||(h.value=[],_.value="all",Y("all")?(g.value=[...i.all],d.total=g.value.length):N())},Oe=(e,a)=>{if(!e||!e.url){P.warning("图片数据不完整，无法预览");return}f.currentPage=1,Le.value=e,a?a.images&&Array.isArray(a.images)?c.value=a:c.value={...a,images:[e]}:c.value={taskName:"图片预览",images:[e]},F.value=!0},Ve=e=>{try{if(!e||!e.url){P.error("无效的图片数据");return}const a=document.createElement("a");a.href=b(e.url);const t=e.url.split("/").pop()||`AI生成图片_${new Date().getTime()}.png`;a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),P.success("图片下载中...")}catch(a){console.error("下载图片失败:",a),P.error("下载图片失败")}},Ue=async()=>{if(!c.value||!c.value.images||c.value.images.length===0){P.warning("没有可下载的图片");return}try{const e=c.value.id;if(!e){P.warning("无法获取任务ID，请刷新页面重试");return}P.info("正在准备下载，请稍候...");const a=`/api/ai/download-task/${e}`,t=document.createElement("a");t.href=a,t.target="_blank",t.download=`${c.value.taskName||"历史图片集"}.zip`,document.body.appendChild(t),t.click(),document.body.removeChild(t),P.success("下载已开始，请稍候")}catch(e){console.error("下载失败:",e),P.error("下载失败: "+(e.message||"未知错误"))}},He=(e,a)=>{if(!e||!e.url){P.warning("图片数据不完整，无法预览");return}U.value=e,S.value=a,V.value=!0,document.body.classList.add("no-scroll"),document.addEventListener("keydown",B)},K=()=>{V.value=!1,document.body.classList.remove("no-scroll"),document.removeEventListener("keydown",B)},B=e=>{if(V.value)switch(e.key){case"ArrowLeft":_e();break;case"ArrowRight":we();break;case"Escape":K();break}},_e=()=>{if(S.value>0){S.value--,U.value=c.value.images[S.value];const e=Math.floor(S.value/H.value);e+1<f.currentPage&&(f.currentPage=e+1)}},we=()=>{if(c.value&&S.value<c.value.images.length-1){S.value++,U.value=c.value.images[S.value];const e=Math.floor(S.value/H.value);e+1>f.currentPage&&(f.currentPage=e+1)}},Be=()=>{K()},ye=()=>{le(),f.currentPage=1,J(),setTimeout(()=>{J(),oe()},50)},oe=()=>{if(c.value&&c.value.images&&c.value.images.forEach(t=>{t&&t.url&&b(t.url)}),!Pe())return;document.querySelectorAll(".image-preview-dialog .preview-image-dialog").forEach(t=>{const o=t.dataset.taskId,u=t.dataset.index;o&&u&&c.value&&c.value.images[u]&&Q.set(`${o}-${b(c.value.images[u].url)}`,!0)})},We=ee(()=>{const e=window.innerWidth*.85;return`${Math.min(e,1200)}px`}),J=()=>{const e=window.innerHeight*.75,a=window.innerWidth*.85,t=Math.min(a,1200);document.documentElement.style.setProperty("--dialog-width",`${t}px`),document.documentElement.style.setProperty("--dialog-height",`${e}px`);let o;t<500?o=2:t<768?o=3:t<1024?o=4:o=5;const u=t<768?8:12,r=t-(o+1)*u,I=Math.floor(r/o);document.documentElement.style.setProperty("--card-width",`${I}px`),document.documentElement.style.setProperty("--grid-columns",o),document.documentElement.style.setProperty("--grid-gap",`${u}px`)},Z=()=>{F.value&&le(),J(),F.value&&ye()},$=y(null),Ye=()=>{$.value=document.querySelector(".filter-item .el-input input"),window.addEventListener("resize",Z),le(),J(),document.addEventListener("keydown",e=>{V.value&&B(e)})},qe=()=>{z.value="",d.currentPage=1};ia(()=>{he(),sessionStorage.removeItem("previousPage")}),be(async()=>{k.value=!0,window.addEventListener("resize",Z),Ye(),D.value&&D.value.addEventListener("scroll",Se),$.value&&$.value.addEventListener("input",W);const e=localStorage.getItem("taskCache");if(e)try{const a=JSON.parse(e);if(Date.now()-a.timestamp<ge&&(Object.keys(a.data).forEach(t=>{t!=="lastFetchTime"&&(t==="dateRange"?i.dateRange=a.data.dateRange:i[t]=a.data[t])}),i.lastFetchTime=a.timestamp,_.value!=="all"&&i[_.value].length>0?g.value=[...i[_.value]]:h.value&&h.value.length===2&&i.dateRange.tasks.length>0&&q(i.dateRange.range,h.value)?g.value=[...i.dateRange.tasks]:i.all.length>0&&(g.value=[...i.all]),g.value.length>0)){d.total=g.value.length,j(),setTimeout(()=>{re()},200),k.value=!1;return}}catch(a){console.error("恢复缓存失败:",a)}await N(),setTimeout(()=>{re()},200),k.value=!1}),ke(()=>{try{const e={timestamp:i.lastFetchTime,data:{all:i.all,today:i.today,"7days":i["7days"],dateRange:i.dateRange}};localStorage.setItem("taskCache",JSON.stringify(e))}catch(e){console.error("保存缓存失败:",e)}window.removeEventListener("resize",Z),document.removeEventListener("keydown",B),$.value&&$.value.removeEventListener("input",W),D.value&&D.value.removeEventListener("scroll",Se),window.historyImageObserver&&window.historyImageObserver.disconnect()});const je=ee(()=>{if(!c.value||!c.value.images)return[];const e=(f.currentPage-1)*H.value,a=e+H.value;return c.value.images.slice(e,a)}),Ke=e=>{f.currentPage=e,setTimeout(()=>{oe()},50)},Je=e=>{f.pageSize=e,f.currentPage=1,setTimeout(()=>{oe()},50)},Ce=e=>(f.currentPage-1)*H.value+e,b=e=>e?e.startsWith("http://")||e.startsWith("https://")?e:`/ai${e.startsWith("/")?e:`/${e}`}`:"";be(()=>{const e=localStorage.getItem("taskCache");if(e)try{const a=JSON.parse(e);if(Date.now()-a.timestamp<ge&&(Object.keys(a.data).forEach(t=>{t!=="lastFetchTime"&&(t==="dateRange"?i.dateRange=a.data.dateRange:i[t]=a.data[t])}),i.lastFetchTime=a.timestamp,_.value!=="all"&&i[_.value].length>0?g.value=[...i[_.value]]:h.value&&h.value.length===2&&i.dateRange.tasks.length>0&&q(i.dateRange.range,h.value)?g.value=[...i.dateRange.tasks]:i.all.length>0&&(g.value=[...i.all]),g.value.length>0)){d.total=g.value.length,j();return}}catch(a){console.error("恢复缓存失败:",a)}N()}),ke(()=>{try{const e={timestamp:i.lastFetchTime,data:{all:i.all,today:i.today,"7days":i["7days"],dateRange:i.dateRange}};localStorage.setItem("taskCache",JSON.stringify(e))}catch(e){console.error("保存缓存失败:",e)}window.removeEventListener("resize",Z),document.removeEventListener("keydown",B),$.value&&$.value.removeEventListener("input",W)});const Ie=e=>{if(!e)return"未命名任务";let a=e.replace(/[_-](\d+)$/,"");a=a.replace(/\s*\(\d+\)$/,""),a=a.trim();const t=[" 副本"," copy"," 拷贝"," 复制"];for(const u of t)if(a.endsWith(u)){a=a.substring(0,a.length-u.length).trim();break}if(!a)return"未命名任务";const o=30;return a.length>o?a.substring(0,o)+"...":a},D=y(null),Q=O(new Map),Ze=O({enabled:!0,buffer:5,itemHeight:280}),Pe=()=>{if(!("IntersectionObserver"in window)){Ze.enabled=!1;return}const e=new IntersectionObserver(a=>{a.forEach(t=>{if(t.isIntersecting){const o=t.target,u=o.dataset.taskId,r=o.dataset.src;r&&!o.src&&(o.src=r,o.classList.add("loading"),o.onload=()=>{o.classList.remove("loading"),o.classList.add("loaded"),Q.set(`${u}-${r}`,!0)},o.onerror=()=>{o.classList.remove("loading"),o.classList.add("error"),o.src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2036%2036%22%3E%3Cpath%20fill%3D%22%23d9d9d9%22%20d%3D%22M18%2C2A16%2C16%2C0%2C1%2C0%2C34%2C18%2C16%2C16%2C0%2C0%2C0%2C18%2C2Zm0%2C30A14%2C14%2C0%2C1%2C1%2C32%2C18%2C14%2C14%2C0%2C0%2C1%2C18%2C32Z%22%2F%3E%3Cpath%20fill%3D%22%23d9d9d9%22%20d%3D%22M18%2C9.5a1.5%2C1.5%2C0%2C0%2C0-1.5%2C1.5v10a1.5%2C1.5%2C0%2C0%2C0%2C3%2C0V11A1.5%2C1.5%2C0%2C0%2C0%2C18%2C9.5Z%22%2F%3E%3Cpath%20fill%3D%22%23d9d9d9%22%20d%3D%22M18%2C24.5A1.5%2C1.5%2C0%2C1%2C0%2C19.5%2C26%2C1.5%2C1.5%2C0%2C0%2C0%2C18%2C24.5Z%22%2F%3E%3C%2Fsvg%3E"}),e.unobserve(o)}})},{root:null,rootMargin:"100px 0px",threshold:.1});return window.historyImageObserver=e,e},re=()=>{const e=Pe();if(!e)return;document.querySelectorAll(".preview-image[data-src]").forEach(t=>{e.observe(t)})},Se=pe(()=>{if(D.value&&(re(),d.currentPage<Math.ceil(d.total/d.pageSize))){const e=D.value.scrollTop,a=D.value.clientHeight,t=D.value.scrollHeight;if(e+a>t-300){const u=(d.currentPage+1-1)*d.pageSize,r=u+d.pageSize;r<=g.value.length&&g.value.slice(u,r).forEach(T=>{if(T.images&&T.images.length>0){const A=new Image;A.src=b(T.images[0].url)}})}}},200);return(e,a)=>{var G,n,L;const t=Xe,o=na,u=Ge,r=ea,I=aa,T=la,A=ta,X=sa;return v(),p(ae,null,[s("div",pa,[s("div",ha,[s("div",fa,[s("div",_a,[a[12]||(a[12]=s("h3",{class:"section-title"},"筛选条件",-1)),s("div",wa,[a[9]||(a[9]=s("div",{class:"filter-label"},"关键词搜索",-1)),m(t,{modelValue:z.value,"onUpdate:modelValue":a[0]||(a[0]=l=>z.value=l),placeholder:"搜索任务名称/关键词",clearable:"",onClear:qe,onInput:E(W),onKeyup:ra(Fe,["enter"])},null,8,["modelValue","onInput"])]),s("div",ya,[a[10]||(a[10]=s("div",{class:"filter-label"},"快速筛选",-1)),s("div",Ca,[(v(),p(ae,null,ce(xe,l=>s("span",{key:l.value,class:de({active:_.value===l.value}),onClick:M=>Ne(l.value)},w(l.label),11,Ia)),64))])]),s("div",Pa,[a[11]||(a[11]=s("div",{class:"filter-label"},"选择日期",-1)),s("div",Sa,[m(o,{modelValue:h.value,"onUpdate:modelValue":a[1]||(a[1]=l=>h.value=l),type:"daterange",placeholder:"选择日期范围",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:Ae,"prefix-icon":E(ca),clearable:!0,editable:!1,"default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)],"unlink-panels":"",class:"custom-date-picker",style:{width:"210px !important","max-width":"210px !important"}},null,8,["modelValue","prefix-icon","default-time"])])])]),s("div",ba,[a[17]||(a[17]=s("h3",{class:"section-title"},"数据统计",-1)),s("div",ka,[s("div",Ea,[s("div",za,w(x.totalImages),1),a[13]||(a[13]=s("div",{class:"stat-label"},"生图总数",-1))]),s("div",Da,[s("div",Ta,w(x.todayImages),1),a[14]||(a[14]=s("div",{class:"stat-label"},"今日生成",-1))]),s("div",xa,[s("div",La,w(x.weekImages),1),a[15]||(a[15]=s("div",{class:"stat-label"},"本周生成",-1))]),s("div",Ra,[s("div",$a,w(x.monthImages),1),a[16]||(a[16]=s("div",{class:"stat-label"},"本月生成",-1))])])])]),oa((v(),p("div",Ma,[s("div",Fa,[s("h2",Na,"历史任务 ("+w(ne.value.length)+")",1),m(u,{type:"primary",icon:E(da),onClick:he,loading:k.value,size:"small",circle:"",title:"刷新数据"},null,8,["icon","loading"])]),s("div",{class:"results-preview",ref_key:"resultsPreviewRef",ref:D},[ne.value.length>0?(v(),p("div",Aa,[(v(!0),p(ae,null,ce(ne.value,l=>(v(),p("div",{key:l.id||l.task_id,class:"task-card"},[s("div",Oa,[s("div",Va,w(l.taskName),1),s("div",Ua,[s("span",Ha,w(me(l.createTime)),1)])]),s("div",Ba,[l.images&&l.images.length>0?(v(),p("div",{key:0,class:de(["preview-image-wrapper",{"tall-image":ve(l.images[0])}])},[s("img",{src:b(l.images[0].url),"data-task-id":l.id||l.task_id,alt:l.taskName,class:"preview-image",onClick:M=>Oe(l.images[0],l),loading:"lazy"},null,8,Wa),Q.has(`${l.id||l.task_id}-${b(l.images[0].url)}`)?R("",!0):(v(),p("div",Ya,a[18]||(a[18]=[s("div",{class:"loading-spinner"},null,-1)]))),l.images.length>=1?(v(),p("div",qa,[s("span",null,"共 "+w(l.images.length)+" 张",1)])):R("",!0)],2)):(v(),p("div",ja,[l.status==="processing"?(v(),ue(r,{key:0},{default:C(()=>[m(E(ua))]),_:1})):(v(),p("span",Ka,"暂无图片"))]))])]))),128))])):(v(),p("div",Ja,[z.value&&z.value.trim()!==""?(v(),ue(I,{key:0},{description:C(()=>[s("span",null,'未找到与 "'+w(z.value)+'" 相关的内容',1)]),_:1})):(v(),ue(I,{key:1,description:"暂无历史任务"}))]))],512),g.value.length>0?(v(),p("div",Za,[s("div",Qa,[m(T,{"current-page":d.currentPage,"onUpdate:currentPage":a[2]||(a[2]=l=>d.currentPage=l),"page-size":d.pageSize,"onUpdate:pageSize":a[3]||(a[3]=l=>d.pageSize=l),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",total:d.total,onSizeChange:Me,onCurrentChange:$e},null,8,["current-page","page-size","total"])])])):R("",!0)])),[[X,k.value]])])]),m(A,{modelValue:F.value,"onUpdate:modelValue":a[7]||(a[7]=l=>F.value=l),width:We.value,class:"image-preview-dialog",onClosed:Be,onOpened:ye,"show-close":!1},{header:C(()=>{var l;return[s("div",Xa,[s("h3",Ga,w(((l=c.value)==null?void 0:l.taskName)||"生成图片预览"),1),s("div",et,[c.value&&c.value.images.length?(v(),p("span",at," 共 "+w(c.value.images.length)+" 张图片 ",1)):R("",!0),m(u,{type:"primary",size:"small",onClick:Ue,disabled:!c.value||!c.value.images.length},{default:C(()=>[m(r,null,{default:C(()=>[m(E(Ee))]),_:1}),a[19]||(a[19]=ga(" 一键打包下载 "))]),_:1,__:[19]},8,["disabled"]),m(u,{size:"small",circle:"",onClick:a[4]||(a[4]=M=>F.value=!1)},{default:C(()=>[m(r,null,{default:C(()=>[m(E(ze))]),_:1})]),_:1})])])]}),default:C(()=>[s("div",tt,[c.value&&c.value.images.length>0?(v(),p("div",st,[(v(!0),p(ae,null,ce(je.value,(l,M)=>(v(),p("div",{key:M,class:"image-card"},[s("div",{class:de(["image-card-inner",{"tall-image":ve(l)}])},[s("img",{src:b(l.url),"data-task-id":c.value.id||c.value.task_id,"data-index":M,alt:"生成图片",class:"preview-image-dialog",onClick:ft=>He(l,Ce(M)),loading:"lazy"},null,8,lt),Q.has(`${c.value.id||c.value.task_id}-${b(l.url)}`)?R("",!0):(v(),p("div",nt,a[20]||(a[20]=[s("div",{class:"loading-spinner"},null,-1)]))),s("div",it,[s("span",ot,w(Ce(M)+1)+"/"+w(c.value.images.length),1),l.width&&l.height?(v(),p("span",rt,w(l.width)+"×"+w(l.height),1)):R("",!0)])],2)]))),128))])):(v(),p("div",ct,[m(I,{description:"暂无生成的图片"})])),c.value&&c.value.images.length>0?(v(),p("div",dt,[m(T,{"current-page":f.currentPage,"onUpdate:currentPage":a[5]||(a[5]=l=>f.currentPage=l),"page-size":f.pageSize,"onUpdate:pageSize":a[6]||(a[6]=l=>f.pageSize=l),"page-sizes":f.pageSizes,total:c.value.images.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Je,onCurrentChange:Ke,small:""},null,8,["current-page","page-size","page-sizes","total"])])):R("",!0)])]),_:1},8,["modelValue","width"]),V.value?(v(),p("div",{key:0,class:"full-image-preview",onClick:K},[s("div",ut,[s("img",{src:b((G=U.value)==null?void 0:G.url),alt:"全屏预览",class:"full-preview-image"},null,8,gt),s("div",vt,w(S.value+1)+"/"+w((n=c.value)==null?void 0:n.images.length),1),s("button",{class:"full-preview-close",onClick:te(K,["stop"])},[m(r,null,{default:C(()=>[m(E(ze))]),_:1})]),s("div",mt,[m(u,{circle:"",onClick:te(_e,["stop"]),disabled:S.value===0},{default:C(()=>[m(r,null,{default:C(()=>[m(E(va))]),_:1})]),_:1},8,["disabled"]),m(u,{circle:"",onClick:te(we,["stop"]),disabled:S.value>=((L=c.value)==null?void 0:L.images.length)-1},{default:C(()=>[m(r,null,{default:C(()=>[m(E(ma))]),_:1})]),_:1},8,["disabled"])]),m(u,{class:"full-preview-download",circle:"",onClick:a[8]||(a[8]=te(l=>Ve(U.value),["stop"])),icon:"Download"},{default:C(()=>[m(r,null,{default:C(()=>[m(E(Ee))]),_:1})]),_:1})])])):R("",!0)],64)}}},zt=Qe(pt,[["__scopeId","data-v-cd8f61a2"]]);export{zt as default};
//# sourceMappingURL=HistoryTask-CDpsBQCW.js.map
