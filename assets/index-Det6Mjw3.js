import{d as tt,b as at,e as st,k as lt,i as He,j as $e,f as ot,a as Qe,E as d,_ as Le,R as vt,S as pt,O as _t}from"./index-Bir-YaCC.js";import{v as Ge}from"./el-loading-Ejxd-_8H.js";import{E as mt,a as gt}from"./el-tab-pane-BNmlJghT.js";import{o as ht,r as v,c as ze,z as Oe,a4 as Se,P as K,s as p,Q as o,a1 as we,S as s,q as x,u as G,aH as yt,ah as k,X as T,aM as ke,M as ge,N as l,b2 as bt,Y as Fe,aK as rt,L as me,C as it,bu as nt,O as ye,a0 as At,F as Re,A as wt,aN as kt,U as et,ai as Et}from"./vue-vendor-BgjGt3mC.js";import{p as Ue,P as xt,a as Ct,e as Rt,c as St,d as Tt,f as Bt,h as Vt,i as Dt,j as Ft,k as Ut,l as It,m as Lt,n as De,o as Ot,q as Pt,r as qt}from"./speech-Co2pyIpu.js";import{E as ut}from"./el-row-CIAyL_Sq.js";import{E as dt}from"./el-col-MzV--S1c.js";import{E as ct}from"./el-progress-C1cQjd7U.js";import{E as Ie}from"./index-DoDbvCKE.js";import{E as zt}from"./el-switch-CyjTL-CK.js";import{t as Ht,a as $t}from"./novel-CHbwD0dH.js";import"./axios-xsH4HHeE.js";import"./lodash-BmZg10rb.js";import"./jszip-C7-yN4-L.js";import"./remark-CBsncvHK.js";import"./quill-BeGMbSWh.js";const Qt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAABTUlEQVR4nO3dMU4cQRBA0ZoVkReOQOBTOeSOBFwMYSGwvE44wIzohW/pvbg0KvWfvAYAAAAAAFhtW/m9y+VympnbneO/Z+ZPrOjh/bdt6RMuD3IzM+87x88z8xaLcmT/u5l53bZt6f6nlR+bmR8HZl8Ozn+FI/s8X2P/1UH4JEFiBIkRJEaQGEFiBIkRJEaQGEFiBIkRJEaQGEFiBIkRJEaQGEFiBIkRJEaQGEFiBIkRJEaQGEFiBIkRJEaQGEFiBIkRJEaQGEFiBIkRJEaQGEFiBIkRJEaQGEFiBIkRJEaQGEFiBIkRJEaQGEFiBIkRJEaQGEFiBIkRJEaQGEFiBIkRJEaQGEFiBIkRJEaQmNVB/s7Mw465x5m5/5iv+bVjn6eZ+XmN/VffoJqdd5zOH0e1ig7tv/oo2M2VHuQu+vfv9b/vDwAAAADA95mZfxj0IQpDdzeNAAAAAElFTkSuQmCC",Gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAEdklEQVR4nO2dv2tTURTHv0mattbWOFirRXBQkaIotI6CLhZ0cVMnF0dxcNF/QXBR3BWrIDjpoIMI4qB/gKu4Kv2h0B+2mv6IXPxeeIQ2zWvOvbn3vvOBkDQp572888453/szUBRFURRFURRFURRFURRFURRFSZyS66/XaDSa3yoD2EjxspZKnV/OHpEzaf9YA5m/lwGseTx+FPhyiDlOL4D5zHs1Pi9EeN2cUfZ0DBMZv5veN84ZBbCHj8IDTzWkH8DKNv82RMetMZVFiUQN8REh7bDIiNlgtIRyXt7xWdTbwUZSYetLqHfiPOuOiZbBAM7HG6HUkFZU6JQ/AOrerswOSKmGtGKdEdNfBDUWU/E0TjmQukyOIWVthpXJdaayIChKytqMxUyrPymZHJrszUtyMjmVOytb9KOWybHWkFZYmey9Nzm27ndfrPM4UaaxEFPWZQAfAbzv0I5JY/tjk8khOuQwgPMAvgjY+krHrNEp/QI2nRJaDfkJYJivr/JC3uK4yVGB0+mjU5ZcDCOn2A4x+d8Owk8A+AzgHIAnQvb/MmIGQ01joUXIDIARnpd1zCifxwHcA3BC6NRG2MrfYMR0TFFa6t8ZOe8AnARwR8juNKNlmdEShOKMpWE4zX4rcws+ZF/WA3ahdMp60/hLV4mtpd6gY0wKvA3goqDtIGRyrF0ntvH3CcAzQbtWJte7JZNT6Mt6TqdICpSVbk26SMEhpthfBzBFpxgV9hjALwHb3mVyDLJ3p1wC8EbwqwwzlW0pk4s8QLUd5sq8BXAawBXWmpkObc4yWpZcyuRUHWKjaxLABwBnKZelbDuTySmnrCz7+HpW0KbhCIA5O/aSal+WC+b4MGqsCuCp0DG+ZUYrRa5laBHyg31X0hGSxThklTVgVdBurVQqdTwYFlqEVDwcwzohyMVCRUlZljLbKxCOwCEpBxctZZUcDEwdZFFfSLGou0hZ1qYZT3khbLtmnSFlMMVZJ5YKU2Cvg1VZJbZBxKcapdgwzOaNu5S7UowwKgYZFeLCILUIsWvgrzlKT3A9zyuVCKlSPR1jv5WkM/rojCUfk+5i7zqxdcKFetrNDNL2koei9/ZO0Qk3OJ9LiuOMiB5GhNf1JzFGyBCfXaSPjupE0SJkks4wM01uCtuuuGhT7ISYVNYpAHspZceFbNpW9kAos+RDd4hNXWby9X1h20EuVwg1Zdn6YcaxHwF4JWi76lPG5iW0CMluDHCBM0qksDK2J+RFPKFFyCEAZwC8BvBSyGZXZWxeUlxjmMVrndA1hlsTzf4ozaTmkOBkbF5SckgSmwek4JAqI8LJukHfxOwQuwFN0DI2LzH29o4xPZVjkLF5iS1Ckt+LMRaHRCtj8xK6Q6KXsXkJ2SGF3Co2RIckJWPzEpJDbET0FnmDfh+y19zlu1p8PtaUnqLd+10CHw6pMxInNvmsxq0zFvRnK/7j8xd27EL86UydSErGSnS/+/7JI7tIMqj9dqWQcIiiKIqiKIqiKIqiKIqiKIqiKErSAPgHIY4WoV4w4XIAAAAASUVORK5CYII=",jt=["src"],Mt={class:"dialog-footer"},Jt=ht({__name:"index",props:{propdata:{type:Object,required:!0},categories:{type:Object,required:!0}},emits:["submitForm","createNewTag","closeDialog"],setup(_e,{expose:F,emit:ee}){const $=v(!1),O=v(),B=v(!1),M=ee,z=_e,Q=ze(()=>_.value.reference_voice_name?[{uid:_.value.reference_voice_id,name:_.value.reference_voice_name,status:"done",url:_.value.reference_voice_url}]:[]);ze(()=>_.value.audition_file_name?[{uid:_.value.audition_file_id,name:_.value.audition_file_name,status:"done",url:_.value.audition_file_url}]:[]);const V=async E=>{if(!["audio/wav","audio/mpeg"].includes(E.type))return d.error("只能上传 mp3/wav格式的文件！"),!1;const b=1024*1024;if(E.size>b)return d.error("文件大小不能超过 1mb"),!1;try{const r=await E.arrayBuffer(),H=(await new AudioContext().decodeAudioData(r)).duration,S=10,j=3;if(H>S)return d.error(`音频持续时间不能超过 ${S} 秒`),!1;if(H<j)return d.error(`音频持续时间不能小于 ${j} 秒`),!1}catch{return d.error("音频时长检测出错，请检查文件是否损坏"),!1}return!0},q=async E=>{const{file:f,onSuccess:b,onError:r}=E,y=new FormData;y.append("file",f);try{const C=await Ue(y);if(C.code===0)_.value.reference_voice_name=f.name,_.value.reference_voice_id=C.data.file_id,d.success("参考音频上传成功!"),O.value.validateField(["reference_voice_name"]);else throw new Error(C.message)}catch(C){r(C),d.error("参考音频上传失败!")}},X=async(E,f)=>{const b=E[0];try{await V(b)&&await q({file:b,onSuccess:y=>{Q.value=[b],_.value.reference_voice_id=y.data.file_id},onError:y=>{d.error("上传失败")}})}catch{d.error("处理文件时出错")}},L=()=>{$.value=!1,h(),M("closeDialog")},le=async()=>{Ie.confirm(`<div style="font-size: 18px; margin: 20px 40px 0;">确定要删除该音色?</div>
      <div style="padding: 20px 40px;">该操作会删除所有文件</div>`,{dangerouslyUseHTMLString:!0,confirmButtonText:"确定删除",cancelButtonText:"取消",confirmButtonClass:"red-button-class"}).then(async()=>{try{B.value=!0;const E=await xt({soundId:_.value.id});if(E.code===0)d.success("删除成功!"),M("closeDialog"),B.value=!1,$.value=!1,h();else throw B.value=!1,new Error(E.message)}catch{d.error("删除失败!"),B.value=!1}}).catch(()=>{})};Oe(()=>{$.value=!0});const Z=async(E,f,b)=>{},te=async E=>{const{file:f,onSuccess:b,onError:r}=E,y=new FormData;if(y.append("file",f),!["image/jpeg","image/png","image/gif"].includes(f.type)){d.error("只能上传 JPG, JPEG, PNG 或 GIF 格式的图片"),E.onError(new Error("Invalid file type"));return}const H=500*1024;if(f.size>H){d.error("图片大小不能超过 500KB"),E.onError(new Error("File size exceeds limit"));return}try{const S=await Ue(y);if(S.code===0)_.value.avatar_id=S.data.file_id,b(S.data,f),d.success("头像图片上传成功!");else throw new Error(S.message)}catch(S){r(S),d.error("头像图片上传失败!")}},J=(E,f)=>{_.value.avatar=URL.createObjectURL(f.raw)},N=(E,f)=>{},de=(E,f)=>{_.value.reference_voice_name="",_.value.reference_voice_id="",_.value.reference_voice_url="",O.value.validateField(["reference_voice_name"])},h=()=>{O.value&&O.value.resetFields()},_=ze(()=>Se({...z.propdata})),ce={name:[{required:!0,message:"请输入音色名称",trigger:"change"}],is_public:[{required:!0,message:"请选择公开状态",trigger:"change"}],gender:[{required:!0,message:"请选择音色性别",trigger:"change"}],industry:[{required:!0,message:"请选择行业",trigger:"change"}],emotion:[{required:!0,message:"请选择音色情绪",trigger:"change"}],audition_file_name:[{required:!0,message:"请上传试听音频",trigger:"change"}],reference_voice_name:[{required:!0,message:"请上传参考音频",trigger:"change"}],reference_voice_text:[{required:!0,message:"请输入参考文本",trigger:"change"}]},re=async()=>{O.value.validate(async(E,f)=>{if(E){const b={industry:_.value.industry,emotion:_.value.emotion,gender:_.value.gender,name:_.value.name,is_public:_.value.is_public,reference_voice_text:_.value.reference_voice_text,avatar_id:_.value.avatar_id,audition_file_id:_.value.audition_file_id,gpt_model_id:_.value.gpt_model_id,sovits_model_id:_.value.sovits_model_id,reference_voice_id:_.value.reference_voice_id,sound_model_id:_.value.id};try{B.value=!0;const r=await Ct(b);if(r.code===0)d.success("编辑成功!"),M("closeDialog"),B.value=!1,$.value=!1,h();else throw B.value=!1,new Error(r.message)}catch{d.error("编辑失败!"),B.value=!1}}})};return F({init:Z}),(E,f)=>{const b=lt,r=ct,y=st,C=dt,H=$e,S=He,j=ut,ie=ot,oe=Qe,fe=at,be=tt,Ee=Ge;return p(),K(be,{modelValue:$.value,"onUpdate:modelValue":f[9]||(f[9]=w=>$.value=w),title:"编辑音色",width:"1000px","before-close":L},{footer:o(()=>[l("div",Mt,[s(oe,{type:"danger",onClick:f[6]||(f[6]=w=>le()),disabled:B.value},{default:o(()=>f[12]||(f[12]=[k("删除音色")])),_:1,__:[12]},8,["disabled"]),s(oe,{onClick:f[7]||(f[7]=w=>L()),disabled:B.value},{default:o(()=>f[13]||(f[13]=[k("取消设置")])),_:1,__:[13]},8,["disabled"]),s(oe,{type:"primary",onClick:f[8]||(f[8]=w=>re()),disabled:B.value},{default:o(()=>f[14]||(f[14]=[k("确认设置")])),_:1,__:[14]},8,["disabled"])])]),default:o(()=>[we((p(),K(fe,{ref_key:"otherForm",ref:O,model:_.value,rules:ce,"label-width":"100px"},{default:o(()=>[s(j,{gutter:20},{default:o(()=>[s(C,{span:10},{default:o(()=>[s(y,{label:"音色头像",prop:"tonePhoto"},{default:o(()=>[s(r,{class:"avatar-uploader",action:"/api/file/upload",ref:"avatarUploadRef","show-file-list":!1,"http-request":te,"on-success":J,"on-remove":N,accept:"image/*"},{default:o(()=>[_.value.avatar?(p(),x("img",{key:0,src:_.value.avatar,class:"avatar_class"},null,8,jt)):(p(),K(b,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[s(G(yt))]),_:1}))]),_:1},512)]),_:1})]),_:1}),s(C,{span:12},{default:o(()=>[s(y,{label:"使用量:",prop:"generateCount"},{default:o(()=>[k(T(_.value.generate_count?_.value.generate_count:"--"),1)]),_:1}),s(y,{label:"公开状态",prop:"is_public"},{default:o(()=>[s(S,{modelValue:_.value.is_public,"onUpdate:modelValue":f[0]||(f[0]=w=>_.value.is_public=w),placeholder:"请选择",style:{width:"240px"}},{default:o(()=>[s(H,{label:"非公开",value:!1}),s(H,{label:"公开",value:!0})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(j,{gutter:20},{default:o(()=>[s(C,{span:10},{default:o(()=>[s(y,{label:"音色名称",prop:"name"},{default:o(()=>[s(ie,{modelValue:_.value.name,"onUpdate:modelValue":f[1]||(f[1]=w=>_.value.name=w),placeholder:"请输入",maxlength:"4","show-word-limit":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),s(C,{span:12},{default:o(()=>[s(y,{label:"行业",prop:"industry"},{default:o(()=>[s(S,{modelValue:_.value.industry,"onUpdate:modelValue":f[2]||(f[2]=w=>_.value.industry=w),placeholder:"请选择",style:{width:"240px"}},{default:o(()=>[(p(!0),x(ge,null,ke(z.categories.industries,w=>(p(),K(H,{key:w,label:w,value:w},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(j,{gutter:20},{default:o(()=>[s(C,{span:10},{default:o(()=>[s(y,{label:"音色性别",prop:"gender"},{default:o(()=>[s(S,{modelValue:_.value.gender,"onUpdate:modelValue":f[3]||(f[3]=w=>_.value.gender=w),placeholder:"请选择",style:{width:"240px"}},{default:o(()=>[s(H,{label:"男性",value:"male"}),s(H,{label:"女性",value:"female"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(C,{span:12},{default:o(()=>[s(y,{label:"情绪",prop:"emotion"},{default:o(()=>[s(S,{modelValue:_.value.emotion,"onUpdate:modelValue":f[4]||(f[4]=w=>_.value.emotion=w),placeholder:"请选择",style:{width:"240px"}},{default:o(()=>[(p(!0),x(ge,null,ke(z.categories.emotions,w=>(p(),K(H,{key:w,label:w,value:w},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(j,{gutter:20},{default:o(()=>[s(C,{span:12},{default:o(()=>[s(y,{label:"参考音频",prop:"reference_voice_name"},{default:o(()=>[s(r,{class:"upload-sovits-model",action:"/api/file/upload","file-list":Q.value,"before-upload":V,"http-request":q,"on-remove":de,"list-type":"text",accept:".mp3,.wav",limit:1,"on-exceed":X},{default:o(()=>[s(oe,{type:"text"},{default:o(()=>f[10]||(f[10]=[k("上传音频")])),_:1,__:[10]}),f[11]||(f[11]=l("span",{class:"remind_style"}," （ 支持mp3/wav格式，文件小于1mb，时长3-10s） ",-1))]),_:1,__:[11]},8,["file-list"])]),_:1})]),_:1})]),_:1}),s(j,{gutter:20},{default:o(()=>[s(C,{span:22},{default:o(()=>[s(y,{label:"参考文本",prop:"reference_voice_text"},{default:o(()=>[s(ie,{modelValue:_.value.reference_voice_text,"onUpdate:modelValue":f[5]||(f[5]=w=>_.value.reference_voice_text=w),rows:3,type:"textarea",placeholder:"请输入",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[Ee,B.value]])]),_:1},8,["modelValue"])}}}),Nt=Le(Jt,[["__scopeId","data-v-eb012566"]]),Wt=bt("BatchNovelStoreStore",{state:()=>({tagListData:[]}),actions:{async treeTagsList(_e){try{const F=await Ht(_e);if(F.code===0)return this.tagListData=ft(F.data.list),F;throw new Error(F.message||"获取标签失败")}catch(F){throw console.error("标签请求异常:",F),F}}}});function ft(_e,F=1,ee=null){const $=[];return _e.forEach(O=>{const B={value:String(O.id),label:O.name,type:F,parent_id:ee,is_public:O.is_public};if($.push(B),O.children&&O.children.length>0){const M=ft(O.children,F+1,O.id);$.push(...M)}}),$}const Kt={class:"dialog-content"},Zt={class:"file-content"},Xt={class:"file-icon"},Yt={class:"text-container"},ea={class:"line1"},ta={class:"line2"},aa={class:"file-content"},sa={class:"file-icon"},la={class:"text-container"},oa={class:"line1"},na={class:"line2"},ra={class:"dialog-footer"},ia={__name:"index",props:{propdata:{type:Object,required:!0}},emits:["submitForm","createNewTag","closeDialog"],setup(_e,{expose:F,emit:ee}){const $="/api/",O=Wt(),B=v(!1),M=v(),z=v(!1),Q=ee,V=_e,q=()=>{B.value=!1,te(),Q("closeDialog")};Oe(()=>{B.value=!0,le()});const X=v({time:"-",size:"-"}),L=v({size:"-",line:"-"}),le=async()=>{await O.treeTagsList({category:"小说"}),J.value=O.tagListData;const b=await Z(V.propdata.audition_file_url,"voice");b&&(X.value.time=b.voiceTime,X.value.size=b.voiceSize);const r=await Z(V.propdata.srt_file_path);r&&(L.value.size=r.srtSize,L.value.line=r.srtLine)},Z=async(b,r)=>{try{const y=await fetch($+b);if(!y.ok)throw new Error(`HTTP error! Status: ${y.status}`);const C=await y.text(),H=new Blob([C]).size,S=(H/(1024*1024)).toFixed(2),j=C.split(`
`).length;let ie=null;if(r=="voice"){const oe=new Audio(b);await new Promise(fe=>{oe.onloadedmetadata=()=>{const be=Math.floor(oe.duration),Ee=Math.floor(be/60),w=be%60;ie=`${String(Ee).padStart(2,"0")}:${String(w).padStart(2,"0")}`,fe()}})}return{voiceTime:ie,voiceSize:S,srtSize:H,srtLine:j}}catch{return null}},te=()=>{M.value&&M.value.resetFields()},J=v([]),N=Se({novel_name:"",tags:"",is_public:!0}),de={is_public:[{required:!0,message:"请选择公开状态",trigger:"change"}],tags:[{required:!0,message:"请选择标签",trigger:"change"}],novel_name:[{required:!0,message:"请输入小数名称",trigger:"change"}]},h=b=>`padding-left: ${(b-1)*10}px;`,_=b=>{M.value.validateField(["tags"]),N.tags=b,b.map(y=>ce(y)).forEach(y=>{J.value.some(H=>H.label===y)||re(y)})},ce=b=>{const r=J.value.find(y=>y.value===b);return r?r.label:b},re=async b=>{let r={name:b,is_public:N.is_public,category:"小说"};await $t(r).then(async y=>{if(y.code===0)d.success("新增标签成功!"),await O.treeTagsList({category:"小说"}),J.value=O.tagListData;else throw d.error("新增标签失败!"),new Error(y.message)}).catch(()=>{d.error("新增标签接口报错!")})},E=async()=>{M.value.validate(async(b,r)=>{if(b){const y={task_id:V.propdata.id,title:N.novel_name,tag_ids:f(N.tags,J.value),is_public:N.is_public};try{z.value=!0;const C=await Rt(y);if(C.code===0)d.success("导入成功!"),Q("closeDialog"),z.value=!1,B.value=!1,te();else throw z.value=!1,new Error(C.message)}catch{d.error("导入失败!"),z.value=!1}}})},f=(b,r)=>{const y=new Set(r.map(S=>S.id)),C={};return r.forEach(S=>{C[S.label]=S.value}),b.map(S=>{const j=Number(S);return y.has(j)?j:C[S]!==void 0?C[S]:S})};return F({init:le}),(b,r)=>{const y=ot,C=st,H=$e,S=He,j=zt,ie=rt("font-awesome-icon"),oe=at,fe=Qe,be=tt,Ee=Ge;return p(),K(be,{modelValue:B.value,"onUpdate:modelValue":r[5]||(r[5]=w=>B.value=w),width:"600px","before-close":q},{header:o(()=>r[6]||(r[6]=[l("div",{class:"el-dialog__header"},[l("span",{class:"el-dialog__title"},"导入小说库"),l("hr",{class:"dialog-header-divider"})],-1)])),footer:o(()=>[l("div",ra,[s(fe,{onClick:r[3]||(r[3]=w=>q()),disabled:z.value},{default:o(()=>r[7]||(r[7]=[k("取消设置")])),_:1,__:[7]},8,["disabled"]),s(fe,{type:"primary",onClick:r[4]||(r[4]=w=>E()),disabled:z.value},{default:o(()=>r[8]||(r[8]=[k("确认导入")])),_:1,__:[8]},8,["disabled"])])]),default:o(()=>[l("div",Kt,[we((p(),K(oe,{ref_key:"otherForm",ref:M,model:N,rules:de,"label-width":"100px","label-position":"top"},{default:o(()=>[s(C,{label:"小说名称",prop:"novel_name"},{default:o(()=>[s(y,{modelValue:N.novel_name,"onUpdate:modelValue":r[0]||(r[0]=w=>N.novel_name=w),placeholder:"请输入小说名称",maxlength:"100","show-word-limit":"",style:{height:"40px","line-height":"40px","border-radius":"20px"}},null,8,["modelValue"])]),_:1}),s(C,{label:"选择标签",prop:"tags"},{default:o(()=>[s(S,{modelValue:N.tags,"onUpdate:modelValue":r[1]||(r[1]=w=>N.tags=w),placeholder:"选择标签",multiple:"",filterable:"","allow-create":"",clearable:"",onChange:_},{default:o(()=>[(p(!0),x(ge,null,ke(J.value,w=>(p(),K(H,{key:w.value,label:w.label,value:w.value},{default:o(()=>[l("span",{style:Fe([h(w.type),{float:"left"}])},T(w.label),5)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(C,{label:"是否公开",prop:"is_public"},{default:o(()=>[s(j,{modelValue:N.is_public,"onUpdate:modelValue":r[2]||(r[2]=w=>N.is_public=w),size:"large","active-text":"公开"},null,8,["modelValue"])]),_:1}),s(C,{label:"音频文件",prop:"voice_file"},{default:o(()=>[l("div",Zt,[l("div",Xt,[s(ie,{icon:"music",class:"iconStyle"})]),l("div",Yt,[l("p",ea,T(V.propdata.industry)+"-"+T(V.propdata.emotion)+"-"+T(V.propdata.name)+"-"+T(V.propdata.gender=="male"?"男":"女")+".wav",1),l("p",ta,T(X.value.time)+" . "+T(X.value.size)+"MB",1)])])]),_:1}),s(C,{label:"字幕文件",prop:"srt_file"},{default:o(()=>[l("div",aa,[l("div",sa,[s(ie,{icon:"closed-captioning",class:"iconStyle"})]),l("div",la,[l("p",oa,T(V.propdata.industry)+"-"+T(V.propdata.emotion)+"-"+T(V.propdata.name)+"-"+T(V.propdata.gender=="male"?"男":"女")+".srt",1),l("p",na,T(L.value.size)+"KB . "+T(L.value.line)+"行",1)])])]),_:1})]),_:1},8,["model"])),[[Ee,z.value]])])]),_:1},8,["modelValue"])}}},ua=Le(ia,[["__scopeId","data-v-2b680080"]]),da={class:"dialog-content"},ca={key:0},fa={__name:"index",props:{propdata:{type:Object,required:!0}},emits:["closeDialog"],setup(_e,{emit:F}){const ee="/api/",$=v(!1),O=_e,B=F,M=()=>{$.value=!1,B("closeDialog")},z=v("");Oe(()=>{$.value=!0,Q()});const Q=async()=>{try{const V=await fetch(ee+O.propdata.srt_file_path);if(V.ok){const q=await V.text();z.value=q}else console.error("获取 SRT 文件失败，状态码:",V.status)}catch(V){console.error("发生错误:",V)}};return(V,q)=>{const X=tt;return p(),K(X,{modelValue:$.value,"onUpdate:modelValue":q[0]||(q[0]=L=>$.value=L),title:"字幕文件预览",width:"600px","before-close":M},{header:o(()=>q[1]||(q[1]=[l("div",{class:"el-dialog__header"},[l("span",{class:"el-dialog__title"},"字幕文件预览"),l("hr",{class:"dialog-header-divider"})],-1)])),default:o(()=>[l("div",da,[z.value?(p(),x("pre",ca,T(z.value),1)):me("",!0)])]),_:1},8,["modelValue"])}}},va=Le(fa,[["__scopeId","data-v-ba92b33f"]]),pa="data:image/png;base64,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",_a="/test-server/assets/drop-down-CMFCaI4l.png",ma={class:"speech-reproduction"},ga={class:"cancel-repro"},ha={class:"add-model"},ya=["src"],ba={class:"button-content"},Aa={class:"first-line-content"},wa={class:"first-item"},ka={class:"upload-file-item"},Ea=["src"],xa=["title"],Ca={key:0,class:"content-wrapper"},Ra={class:"second-content"},Sa={class:"second-item"},Ta={class:"text-container"},Ba={class:"text-item"},Va={class:"text-item"},Da={class:"text-item"},Fa={class:"third-content"},Ua={class:"icon-ele"},Ia=["src"],La={class:"third-content-button"},Oa={class:"voice-label-left"},Pa={class:"voice-label-right"},qa=["src","onPlay"],za={key:0,class:"no-more"},Ha={class:"four-content"},$a={class:"four-item"},Qa={class:"text-container"},Ga={class:"text-item"},ja={class:"text-item"},Ma={class:"text-item"},Ja={__name:"index",props:{categories:{type:Object,required:!0}},emits:["jumpToPerson"],setup(_e,{emit:F}){const ee=_e,$=F,O=v(3e3);v(3);let B=v(0);const M=v(null);Oe(()=>{L.value=!0,ae()}),it(()=>{Pe.value=!1,clearTimeout(M.value)});const z=v(!1),Q=v(!1),V=v(!1),q=v(!1),X=v(!1),L=v(!1),le=v(!0),Z=v(!1),te=v(!0),J=v(!0),N=v(!0),de=v(!0);let h=Se({avatar_id:"",avatar:"",industry:"",audition_file_id:"",auditionFileList:[],reference_voice_id:"",referenceVoiceList:[],gender:"",emotion:"",name:"",referText:""});const _=new FormData,ce=v();v();const re=v([]),E=Se({one:"",two:"",three:""}),f=Se({one:"",two:"",three:""}),b={avatar_id:[{required:!0,message:"请上传头像",trigger:"change"}],name:[{required:!0,message:"请输入名称",trigger:"change"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],industry:[{required:!0,message:"请选择行业",trigger:"change"}],emotion:[{required:!0,message:"请选择情绪",trigger:"change"}],reference_voice_id:[{required:!0,message:"请上传参考音频",trigger:"change"}],referText:[{required:!0,message:"请输入参考文本",trigger:"change"}]},r=async c=>{if(!["image/jpeg","image/png","image/gif"].includes(c.type))return d.error("只能上传 JPG, JPEG, PNG 或 GIF 格式的图片"),!1;const R=500*1024;return c.size>R?(d.error("图片大小不能超过 500KB"),!1):!0},y=async c=>{if(!["audio/wav","audio/mpeg"].includes(c.type))return d.error("只能上传 mp3/wav格式的文件！"),!1;const R=1024*1024;if(c.size>R)return d.error("文件大小不能超过 1mb"),!1;try{const W=await c.arrayBuffer(),m=(await new AudioContext().decodeAudioData(W)).duration,A=10,i=3;if(m>A)return d.error(`音频持续时间不能超过 ${A} 秒`),!1;if(m<i)return d.error(`音频持续时间不能小于 ${i} 秒`),!1}catch{return d.error("音频时长检测出错，请检查文件是否损坏"),!1}return!0},C=async c=>{if(le.value=!1,!["audio/mpeg"].includes(c.type))return d.error("只能上传 mp3格式的文件！"),!1;const R=1024*1024*5;if(c.size>R)return d.error("文件大小不能超过 5mb"),!1;const W=await c.arrayBuffer(),m=(await new AudioContext().decodeAudioData(W)).duration,A=60;return m<A?(d.error(`音频持续时间不能小于 ${A} 秒`),!1):!0},H=async c=>{X.value=!0;const{file:e,onSuccess:R,onError:W}=c,t=new FormData;t.append("file",e);try{const a=await Ue(t);if(a.code===0)h.avatar_id=a.data.file_id,d.success("头像上传成功!"),ce.value.validateField(["avatar_id"]),_.set("avatar",e),X.value=!1;else throw X.value=!1,new Error(a.message)}catch{d.error("头像上传失败!"),X.value=!1}},S=async c=>{const{file:e,onSuccess:R,onError:W}=c,t=new FormData;t.append("file",e);try{const a=await Ue(t);if(a.code===0)h.reference_voice_id=a.data.file_id,R(a.data,e),d.success("参考音频上传成功!"),ce.value.validateField(["reference_voice_id"]),_.set("reference_voice",e);else throw new Error(a.message)}catch{d.error("参考音频上传失败!")}},j=new FormData,ie=async c=>{const{file:e,onSuccess:R,onError:W}=c,t=new FormData;t.append("file",e);try{const a=await Ue(t);if(a.code===0)R(a.data,e),d.success("复刻音频上传成功!"),Z.value=!0,J.value=!1,j.set("audios",e);else throw new Error(a.message)}catch(a){W(a),d.error("复刻音频上传失败!")}},oe=async(c,e)=>{const R=c[0];try{await y(R)&&await S({file:R,onSuccess:t=>{h.referenceVoiceList=[R]},onError:t=>{d.error("上传失败")}})}catch{d.error("处理文件时出错")}},fe=(c,e)=>{h.avatar=URL.createObjectURL(e.raw)},be=(c,e,R)=>{re.value=R},Ee=(c,e)=>{ce.value.validateField(["reference_voice_id"])},w=c=>{re.value=[],le.value=!0,J.value=!0},je=(c,e)=>{re.value=e,le.value=!0,J.value=!0},Pe=v(!0),ae=async()=>{await St().then(c=>{if(c.code===0){L.value=!1;const e=c.data??"";e==""&&(Pe.value=!1,Q.value=!1,q.value=!1),h.id=e.id?e.id:null,h.avatar_id=e.avatar_id?e.avatar_id:"",h.avatar=e.avatar_url?"/api"+e.avatar_url:"",h.name=e.name?e.name:"",h.industry=e.industry?e.industry:"",h.audition_file_id=e.audition_id?e.audition_id:"",h.reference_voice_id=e.reference_id?e.reference_id:"",h.gender=e.gender?e.gender:"",h.emotion=e.emotion?e.emotion:"",h.referText=e.reference_text?e.reference_text:"",h.auditionFileList=e.audition_id?[{uid:e.audition_id?e.audition_id:"",name:e.audition_name?e.audition_name:"",status:"done",url:e.audition_url?e.audition_url:""}]:[],h.referenceVoiceList=e.reference_id?[{uid:e.reference_id?e.reference_id:"",name:e.reference_name?e.reference_name:"",status:"done",url:e.reference_url?e.reference_url:""}]:[],e.upload_file_url&&e.upload_file_url!==""?(Z.value=!0,le.value=!1,re.value.length==0&&(re.value=e.upload_file_url?[{name:e.upload_file_name?e.upload_file_name:"",status:"done",url:e.upload_file_url?e.upload_file_url:""}]:[])):e.id&&!e.upload_file_url?(re.value=[],te.value=!1,le.value=!0):(re.value=[],Z.value=!1,Q.value=!1,q.value=!1,te.value=!0,le.value=!0,J.value=!0,N.value=!0,de.value=!0),E.one="",E.two="",E.three="",f.one="",f.two="",f.three="",e.step_list&&Object.keys(e.step_list).length>0?(te.value=!0,P(Object.keys(e.step_list).length,e.step_list)):(Q.value=!1,q.value=!1)}else d.error(c.message),L.value=!1}).catch(c=>{d.error(c),L.value=!1})},P=(c,e)=>{if(E.one=se(e[0]),E.two=se(e[1]),E.three=se(e[2]),f.one=se(e[5]),f.two=se(e[9],"one"),f.three=se(e[10],"two"),c<=3)Object.values(e).includes("progressing")?(J.value=!0,Q.value=!0,B.value++,M.value=setTimeout(()=>ae(),O.value)):e[2]=="success"?(d.success("一键处理成功!"),Q.value=!1,J.value=!0,N.value=!1,de.value=!1):(J.value=!1,Q.value=!1);else if(c==4&&"3"in e)J.value=!0,N.value=!1,de.value=!1;else if(c>=4&&c<=8){const R=Object.values(e);if(e.hasOwnProperty(3)){const W=R.findIndex(t=>t===e[3]);W!==-1&&R.splice(W,1)}R.includes("progressing")?(q.value=!0,de.value=!0,B.value++,M.value=setTimeout(()=>ae(),O.value)):e[20]=="success"?(q.value=!1,Ie.confirm(`<div style="font-size: 18px; margin: 20px 40px 0;">训练完成！</div>
          <div style="padding: 20px 40px;">请在私有语音库中查看</div>`,{dangerouslyUseHTMLString:!0,confirmButtonText:"确认",confirmButtonClass:"red-button",showCancelButton:!1,beforeClose:(W,t,a)=>{a(),$("jumpToPerson")}}).then(async()=>{$("jumpToPerson")})):(de.value=!1,q.value=!1)}};function se(c,e){return e==="one"&&c==="success"?"SoVITS训练完成":e==="two"&&c==="success"?"GPT训练完成":Me(c)}function Me(c){switch(c){case"waiting":return"等待中...";case"progressing":return"处理中...";case"success":return"已完成";case"failed":return"处理失败";case"stopped":return"已停止";default:return""}}const Je=async()=>{if(L.value==!0)return d.warning("正在清空中..."),!1;Ie.confirm(`<div style="font-size: 18px; margin: 20px 40px 0;">确定要清空吗？</div>
      <div style="padding: 20px 40px;">该操作会中断正在复刻的语音</div>`,{dangerouslyUseHTMLString:!0,confirmButtonText:"确定",cancelButtonText:"取消",confirmButtonClass:"red-button-class"}).then(async()=>{try{L.value=!0;const c=await Tt();if(c.code===0)L.value=!1,d.success("清空成功!"),L.value=!0,ce.value.resetFields(),ae();else throw L.value=!1,new Error(c.message)}catch{L.value=!1,d.error("清空失败!")}}).catch(()=>{})},ve=async()=>{h.avatar=null,h.auditionFileList=[],h.referenceVoiceList=[],ce.value.resetFields()},ne=async()=>{ce.value.validate(async(c,e)=>{c&&Ie.confirm(`<div style="font-size: 18px; margin: 20px 40px 0;">确定要保存该音色？</div>
          <div style="padding: 20px 40px;">保存后复刻期间音色不可更改！</div>`,{dangerouslyUseHTMLString:!0,confirmButtonText:"确定保存",cancelButtonText:"取消",confirmButtonClass:"red-button"}).then(async()=>{h.id!==null&&h.id!==void 0&&_.set("id",h.id),_.set("name",h.name),_.set("industry",h.industry),_.set("gender",h.gender),_.set("emotion",h.emotion),_.set("reference_voice_text",h.referText);try{z.value=!0;const R=await Bt(_);R.code===0?(d.success("新增音色成功!"),z.value=!1,te.value=!1):(z.value=!1,d.error(R.message))}catch{d.error("新增音色失败!"),z.value=!1}}).catch(()=>{})})},Ne=async()=>{Q.value=!0;try{if((await Vt(j)).code===0)setTimeout(()=>ae(),2e3);else{d.error("发生错误，请稍后重试!"),Q.value=!1;return}}catch{d.error("发生错误，请稍后重试!"),Q.value=!1;return}},Te=v([]),ue=v(0),xe=v([]),Ce=v({}),Ae=v([]),Be=async()=>{if(Te.value.length>0&&xe.value.length==0)try{V.value=!0;const c=await Ft();if(c.code===0)V.value=!1,Ae.value=c.data.data.list?c.data.data.list:[],xe.value=Ae.value.slice(0,10),ue.value=1;else throw V.value=!1,new Error(c.message)}catch{V.value=!1,ue.value=1,xe.value=Ae.value.slice(0,10),d.error("语音标注获取数据失败!")}},pe=v(null),We=c=>{if(pe.value!==null&&pe.value!==c){const e=Ce.value[pe.value];e&&e.pause()}pe.value=c},Ke=()=>{pe.value=null},Ve=()=>{ue.value++,xe.value=Ae.value.slice((ue.value-1)*10,ue.value*10)},Ze=()=>{ue.value--,xe.value=Ae.value.slice((ue.value-1)*10,ue.value*10)},Xe=async()=>{try{V.value=!0;const c={task_id:"task_id",asr_data:{data:{list:Ae.value}}},e=await Dt(c);if(e.code===0)V.value=!1,d.success("保存标注成功!");else throw V.value=!1,new Error(e.message)}catch{V.value=!1,ue.value=1,d.error("语音标注保存失败!")}},Ye=async()=>{Te.value=[];try{const c=await Ut();if(c.code===0)ae();else{d.error(c.message),q.value=!1;return}}catch{d.error("发生错误，请稍后重试!"),q.value=!1;return}};return(c,e)=>{const R=Qe,W=lt,t=ct,a=st,m=dt,A=$e,i=He,u=ut,U=ot,he=at,D=vt,I=pt,n=Ge;return p(),x("div",ma,[l("div",ga,[s(R,{class:"cancel-repro-button",type:"danger",onClick:e[0]||(e[0]=g=>Je())},{default:o(()=>e[14]||(e[14]=[k("清空语音复刻信息")])),_:1,__:[14]})]),we((p(),x("div",null,[l("div",ha,[e[20]||(e[20]=l("div",{class:"add-title"},"新建音色",-1)),we((p(),K(he,{ref_key:"toneForm",ref:ce,model:G(h),rules:b},{default:o(()=>[s(u,{gutter:24},{default:o(()=>[s(m,{span:5,class:"avatar-content"},{default:o(()=>[s(a,{prop:"avatar_id"},{default:o(()=>[l("div",null,[we((p(),K(t,{class:"avatar-uploader",action:"/api/file/upload",ref:"avatarUploadRef","show-file-list":!1,"http-request":H,"before-upload":r,"on-success":fe,accept:"image/*",disabled:Z.value},{default:o(()=>[G(h).avatar?(p(),x("img",{key:0,src:G(h).avatar,class:"avatar_class"},null,8,ya)):(p(),K(W,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[s(G(nt))]),_:1}))]),_:1},8,["disabled"])),[[n,X.value]]),e[15]||(e[15]=l("div",{class:"remind_photo"},"上传图片(小于500kb)",-1))])]),_:1})]),_:1}),s(m,{span:8},{default:o(()=>[s(a,{label:"行业",prop:"industry"},{default:o(()=>[s(i,{modelValue:G(h).industry,"onUpdate:modelValue":e[1]||(e[1]=g=>G(h).industry=g),placeholder:"下拉菜单",style:{width:"240px"},disabled:Z.value},{default:o(()=>[(p(!0),x(ge,null,ke(ee.categories.industries,g=>(p(),K(A,{key:g,label:g,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),s(a,{label:"性别",prop:"gender"},{default:o(()=>[s(i,{modelValue:G(h).gender,"onUpdate:modelValue":e[2]||(e[2]=g=>G(h).gender=g),placeholder:"下拉菜单",style:{width:"240px"},disabled:Z.value},{default:o(()=>[s(A,{label:"男性",value:"male"}),s(A,{label:"女性",value:"female"})]),_:1},8,["modelValue","disabled"])]),_:1}),s(a,{label:"参考音频",prop:"reference_voice_id",class:"refer-Audio"},{default:o(()=>[s(t,{disabled:Z.value,action:"/api/file/upload",ref:"referAudioUploadRef","file-list":G(h).referenceVoiceList,"http-request":S,"before-upload":y,"on-remove":Ee,accept:".mp3,.wav",limit:1,"on-exceed":oe},{default:o(()=>[e[17]||(e[17]=l("span",{class:"remind_style"}," （ 支持mp3/wav格式，文件小于1mb，时长3-10s ） ",-1)),s(R,{type:"primary",link:"",disabled:Z.value},{default:o(()=>e[16]||(e[16]=[k("上传音频")])),_:1,__:[16]},8,["disabled"])]),_:1,__:[17]},8,["disabled","file-list"])]),_:1})]),_:1}),s(m,{span:8},{default:o(()=>[s(a,{label:"情绪",prop:"emotion"},{default:o(()=>[s(i,{modelValue:G(h).emotion,"onUpdate:modelValue":e[3]||(e[3]=g=>G(h).emotion=g),placeholder:"下拉菜单",style:{width:"240px"},disabled:Z.value},{default:o(()=>[(p(!0),x(ge,null,ke(ee.categories.emotions,g=>(p(),K(A,{key:g,label:g,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),s(u,{gutter:24},{default:o(()=>[s(m,{span:5,class:"name-content"},{default:o(()=>[s(a,{label:"音色名称",prop:"name"},{default:o(()=>[s(U,{disabled:Z.value,modelValue:G(h).name,"onUpdate:modelValue":e[4]||(e[4]=g=>G(h).name=g),placeholder:"请输入",maxlength:"4","show-word-limit":"",clearable:"",style:{width:"150px"}},null,8,["disabled","modelValue"])]),_:1})]),_:1}),s(m,{span:18},{default:o(()=>[s(a,{label:"参考音频文本",prop:"referText"},{default:o(()=>[s(U,{disabled:Z.value,modelValue:G(h).referText,"onUpdate:modelValue":e[5]||(e[5]=g=>G(h).referText=g),rows:3,type:"textarea",placeholder:"请输入",maxlength:"100","show-word-limit":""},null,8,["disabled","modelValue"])]),_:1})]),_:1})]),_:1}),s(u,{gutter:24},{default:o(()=>[s(m,{span:23},{default:o(()=>[l("div",ba,[s(R,{onClick:e[6]||(e[6]=g=>ve()),disabled:z.value||Z.value},{default:o(()=>e[18]||(e[18]=[k("清空信息")])),_:1,__:[18]},8,["disabled"]),s(R,{type:"primary",onClick:e[7]||(e[7]=g=>ne()),disabled:z.value||Z.value},{default:o(()=>e[19]||(e[19]=[k("保存")])),_:1,__:[19]},8,["disabled"])])]),_:1})]),_:1})]),_:1},8,["model"])),[[n,z.value]])]),l("div",Aa,[l("div",null,[e[23]||(e[23]=k(" 1.上传复刻音频 ")),l("div",wa,[s(t,{class:"first-uploader",action:"/api/file/upload",ref:"avatarUploadRef","http-request":ie,"before-upload":C,"on-success":be,"on-remove":je,"file-list":re.value,accept:".mp3",limit:1,disabled:te.value},{file:o(({file:g})=>[l("div",ka,[l("img",{src:G(pa),alt:"filter",class:"upload-file-icon"},null,8,Ea),l("span",{class:"file-name",title:g.name},T(g.name),9,xa),s(R,{type:"primary",link:"",onClick:Y=>w(g),disabled:te.value,class:"remove-button"},{default:o(()=>e[21]||(e[21]=[k("X")])),_:2,__:[21]},1032,["onClick","disabled"])])]),default:o(()=>[le.value?(p(),x("div",Ca,[s(W,{class:"first-item-icon"},{default:o(()=>[s(G(nt))]),_:1}),e[22]||(e[22]=l("div",{class:"remind-copy-update"},[k("上传音频 "),l("br"),l("span",{class:"remind-copy-update-span"},"（大于1分钟，mp3格式，小于5mb）")],-1))])):me("",!0)]),_:1},8,["file-list","disabled"])])]),l("div",Ra,[e[28]||(e[28]=k(" 2.语音处理 ")),l("div",Sa,[s(R,{class:"button-container",onClick:e[8]||(e[8]=g=>Ne()),type:"primary",disabled:Q.value||J.value},{default:o(()=>e[24]||(e[24]=[k(" 一键处理 ")])),_:1,__:[24]},8,["disabled"]),we((p(),x("div",Ta,[l("div",Ba,[e[25]||(e[25]=l("span",{class:"text-item-contant"},"UVR-5去杂音",-1)),l("span",null,T(E.one),1)]),l("div",Va,[e[26]||(e[26]=l("span",{class:"text-item-contant"},"语音切割",-1)),l("span",null,T(E.two),1)]),l("div",Da,[e[27]||(e[27]=l("span",{class:"text-item-contant"},"ASR文本标注",-1)),l("span",null,T(E.three),1)])])),[[n,Q.value]])])])]),l("div",Fa,[s(I,{modelValue:Te.value,"onUpdate:modelValue":e[9]||(e[9]=g=>Te.value=g),onChange:Be},{default:o(()=>[we((p(),K(D,{disabled:N.value,name:"thirdPanel"},{title:o(()=>e[29]||(e[29]=[l("div",{class:"third-title"}," 3.语音标注（人工标注可更加精确；可跳过此步骤，直接训练！）",-1)])),icon:o(({isActive:g})=>[l("span",Ua,[l("img",{src:G(_a),class:ye(["icon-ele-img",{rotate:g}])},null,10,Ia),k(" "+T(g?"收起菜单":"下拉菜单"),1)])]),default:o(()=>[l("div",null,[l("div",La,[s(R,{type:"primary",link:"",disabled:ue.value==Math.ceil(Ae.value.length/10),onClick:Ve},{default:o(()=>e[30]||(e[30]=[k("下一页")])),_:1,__:[30]},8,["disabled"]),s(R,{type:"primary",link:"",disabled:ue.value==1,onClick:Ze},{default:o(()=>e[31]||(e[31]=[k("上一页")])),_:1,__:[31]},8,["disabled"]),s(R,{type:"primary",link:"",onClick:Xe},{default:o(()=>e[32]||(e[32]=[k("保存标注")])),_:1,__:[32]})]),(p(!0),x(ge,null,ke(xe.value,(g,Y)=>(p(),K(u,{gutter:24,key:Y,class:"third-content-row"},{default:o(()=>[s(m,{span:12},{default:o(()=>[l("div",Oa,[k(T("Text "+Y)+" ",1),s(U,{class:"voice-label-left-text",modelValue:g.text,"onUpdate:modelValue":qe=>g.text=qe,rows:3,type:"textarea",placeholder:"请输入"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024),s(m,{span:12},{default:o(()=>[l("div",Pa,[l("audio",{ref_for:!0,ref:qe=>{Ce.value[Y]=qe},src:"/api"+g.file_url,controlsList:"nodownload",controls:"",class:"voice-label-right-audio",onPlay:qe=>We(Y),onEnded:Ke},null,40,qa)])]),_:2},1024)]),_:2},1024))),128)),ue.value==Math.ceil(Ae.value.length/10)?(p(),x("div",za,"没有更多了")):me("",!0)])]),_:1},8,["disabled"])),[[n,V.value]])]),_:1},8,["modelValue"])]),l("div",Ha,[e[37]||(e[37]=k(" 4.语音模型训练 ")),l("div",$a,[s(R,{class:"button-container",onClick:e[10]||(e[10]=g=>Ye()),type:"primary",disabled:de.value||q.value},{default:o(()=>e[33]||(e[33]=[k("开始训练")])),_:1,__:[33]},8,["disabled"]),we((p(),x("div",Qa,[l("div",Ga,[e[34]||(e[34]=k("训练集格式化 ")),l("div",null,[s(U,{modelValue:f.one,"onUpdate:modelValue":e[11]||(e[11]=g=>f.one=g),readonly:""},null,8,["modelValue"])])]),l("div",ja,[e[35]||(e[35]=k("SoVITS训练进程输出信息 ")),l("div",null,[s(U,{modelValue:f.two,"onUpdate:modelValue":e[12]||(e[12]=g=>f.two=g),rows:2,type:"textarea",readonly:""},null,8,["modelValue"])])]),l("div",Ma,[e[36]||(e[36]=k("GPT训练进程输出信息 ")),l("div",null,[s(U,{modelValue:f.three,"onUpdate:modelValue":e[13]||(e[13]=g=>f.three=g),rows:2,type:"textarea",readonly:""},null,8,["modelValue"])])])])),[[n,q.value]])])])])),[[n,L.value]])])}}},Na=Le(Ja,[["__scopeId","data-v-fd7f79db"]]),Wa=["element-loading-text"],Ka={key:0,class:"speech_synthesis_content"},Za={class:"main-container"},Xa={class:"voice-list"},Ya={class:"voice-list-header"},es={class:"language-select"},ts={class:"filter-bar"},as={class:"filter-buttons"},ss={class:"filter-bar"},ls={class:"filter-buttons"},os={class:"filter-bar"},ns={class:"filter-buttons"},rs={class:"voice-list-content"},is={class:"voice-grid"},us=["onClick"],ds={key:0,class:"corner-label hot-label"},cs={key:1,class:"corner-label new-label"},fs=["onClick"],vs=["src","alt"],ps={class:"voice-name"},_s=["onClick"],ms=["src"],gs=["src"],hs=["src","onEnded"],ys={class:"text-editor"},bs={class:"editor-header"},As={class:"language-select"},ws={class:"speed-control"},ks={class:"speed-slider-container"},Es={class:"speed-value"},xs={class:"textarea-container"},Cs={class:"textarea-label"},Rs={class:"label-text"},Ss={class:"char-count"},Ts={class:"action-buttons"},Bs={class:"task-list"},Vs={class:"task-list-content"},Ds={key:0},Fs={class:"task-header"},Us={class:"task-info"},Is={class:"task-name"},Ls={class:"task-date"},Os={class:"task-voice"},Ps={class:"task-content"},qs={key:0,class:"task-preview"},zs=["src","onPlay","onEnded"],Hs={class:"task-actions"},$s={class:"dropdown"},Qs=["onClick"],Gs=["onClick"],js=["onClick"],Ms=["onClick"],Js=["onClick"],Ns=["onClick"],Ws=["innerHTML","onClick"],Ks=["onClick"],Zs=["onClick"],Xs=["onClick"],Ys={key:1},el={key:1,class:"repro-content"},tl={__name:"index",setup(_e){const F="/api/",ee=v([]),$=v(1),O=v(20),B=v(""),M=v(0),z=()=>{const t=B.value.length;t<=6e3?M.value=t:(B.value=B.value.slice(0,6e3),M.value=6e3)},Q=v({}),V=t=>{Q.value[t.id]=!Q.value[t.id]},q=t=>{if(ae.value&&ae.value!==t){const a=fe.value[ae.value];a&&(a.pause(),a.currentTime=0)}ae.value=t},X=v("speechHC"),L=v(),le=v(!1),Z=()=>{};let te;Oe(()=>{C(),pe(),We(),te=t=>{const a=document.querySelector(".dropdown-content.show");a&&!a.contains(t.target)&&!t.target.matches(".dropdown-button")&&P.value.forEach(m=>{Q.value[m.id]=!1})},document.addEventListener("click",te)});const J=v(null);it(()=>{te&&document.removeEventListener("click",te),clearInterval(J.value)}),At(()=>{e.value.clear(),clearInterval(J.value)});const N=()=>{($.value-1)*O.value+O.value;const a=ce.value;a.length>0&&(ee.value=[...ee.value,...a])},de=(t,a)=>{a=="voice"?q(t):Te(t)},h=async(t,a)=>{const m=u=>u.replace(/[-:\s]/g,"");let A=[];if(a=="voice")A=[t.audition_file_url];else if(a=="srt")A=[t.srt_file_path.startsWith("http")?t.srt_file_path:`${F}${t.srt_file_path}`];else if(a=="all"){const u=t.srt_file_path.startsWith("http")?t.srt_file_path:`${F}${t.srt_file_path}`;A=[t.audition_file_url,u]}const i=u=>u===t.audition_file_url||u===`${F}${t.audition_file_url}`?`${t.industry}${t.emotion}${t.name}${t.gender==="male"?"男":"女"}${m(t.create_time)}.wav`:u===t.srt_file_path||u===`${F}${t.srt_file_path}`?`${t.industry}${t.emotion}${t.name}${t.gender==="male"?"男":"女"}${m(t.create_time)}.srt`:"unknown_file";if(A.length)for(const u of A){d.success("请稍候...");try{const U=await fetch(u);if(!U.ok)throw new Error(`HTTP error! status: ${U.status}`);const he=await U.blob(),D=URL.createObjectURL(he),I=document.createElement("a");I.href=D,I.download=i(u),document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(D)}catch{d.error("下载失败，请稍后重试")}}},_=v([]),ce=ze(()=>_.value.map(t=>({id:t.id,name:t.name,emotion:t.emotion,avatar:`${F}${t.avatar}`,avatar_id:t.avatar_id,gender:t.gender,industry:t.industry,is_public:t.is_public,audition_file_id:t.audition_file_id,audition_file_name:t.audition_file_name,audition_file_url:`${F}${t.audition_file_url}`,generate_count:t.generate_count,reference_voice_id:t.reference_voice_id,reference_voice_name:t.reference_voice_name,reference_voice_url:`${F}${t.reference_voice_url}`,reference_voice_text:t.reference_voice_text,gpt_model_id:t.gpt_model_id,sovits_model_id:t.sovits_model_id,create_time_new:t.create_time?re(t.create_time):!1,status:t.status?t.status:"remain"}))),re=t=>{if(!t)return!1;const a=new Date,m=new Date(t);a.setHours(23,59,59,999);const A=new Date(a);return A.setDate(a.getDate()-7),A.setHours(0,0,0,0),m>=A&&m<=a},E=v(null),f=v(null),b=Se({voiceModel:"",language:"中文",pauseOption:"按标点符号切",adjustLast:!1,speed:1,text:"",volume:1}),r=Se({gender_condition:"",industry_condition:null,emotion_condition:null,isShare:!0}),y=Se({industries:[],emotions:[]}),C=async()=>{try{const t=await It();if(t.code===0)y.industries=t.data.industries,y.emotions=t.data.emotions;else throw new Error(t.message)}catch{d.error("获取分类数据失败")}},H=t=>{f.value=t,r.gender_condition=t,pe()},S=t=>{ee.value=[],r.isShare=t,le.value=!0,pe()},j=v(!1),ie=v(!1),oe=v(!1),fe=v([]),be=t=>{j.value=!0,L.value=t},Ee=()=>{j.value=!1,pe()},w=()=>{ie.value=!1,pe()},je=()=>{oe.value=!1},Pe=()=>{X.value="speechHC",r.gender_condition="",r.industry_condition=null,r.emotion_condition=null,S(!1)},ae=v(null),P=v([]),se=v({}),Me=v(!1),Je=v(""),ve=v({}),ne=v({}),Ne=t=>ae.value===t,Te=t=>{const a=fe.value[t];a&&(ae.value===t?(a.pause(),ae.value=null):(document.querySelectorAll("audio").forEach(A=>{A.paused||(A.pause(),A.currentTime=0)}),a.play().then(()=>{ae.value=t}).catch(A=>{d.error("音频播放失败"),ae.value=null})))},ue=t=>{E.value=t,b.voiceModel=t,e.value.has(t.id)||(e.value.set(t.id,t.audition_file_url),Re(()=>{const a=document.querySelector(`.voice-card[data-id="${t.id}"] audio`);a&&(a.src=t.audition_file_url)}))},xe=async()=>{if(B.value==""){d.warning("请输入文本进行语音合成");return}if(!E.value){d.warning("请选择音色模型进行语音合成");return}d.success("生成音频中，请稍候...");try{const t={sound_model_id:E.value.id,language:b.language,pause_option:b.pauseOption,adjust_last:b.adjustLast,speed:b.speed,text:B.value},a=await Ot(t);if(a.code!==0)throw new Error(a.message||"语音合成请求失败");await Be("voice")}catch(t){d.error(t.message||"语音合成失败")}},Ce=v([]),Ae=async()=>{await xe();const t=P.value[0];t&&Ce.value.push(t.id)},Be=async(t,a,m)=>{if(t==="voice"){const A=await De(b.voiceModel.id);if(A.code!==0)throw new Error(A.message||"获取状态失败");A.data.list.forEach(u=>{const U=P.value.findIndex(he=>he.id===u.id);if(U!==-1){const he=P.value[U];Object.keys(u).some(I=>I!=="id"?u[I]!==he[I]:!1)&&(P.value[U]={id:u.id,audition_file_url:`${F}${u.file_url}`,text:u.text,status:u.status,industry:u.industry,emotion:u.emotion,name:u.name,gender:u.gender,create_time:u.create_time,srt_file_id:u.srt_file_id??null,srt_file_path:u.srt_file_path??null},Re(()=>{se.value[u.id]=!1,ve.value[u.id]=0,ne.value[u.id]=""}))}else P.value.unshift({id:u.id,audition_file_url:`${F}${u.file_url}`,text:u.text,status:u.status,industry:u.industry,emotion:u.emotion,name:u.name,gender:u.gender,create_time:u.create_time,srt_file_id:u.srt_file_id??null,srt_file_path:u.srt_file_path??null}),Re(()=>{se.value[u.id]=!1,ve.value[u.id]=0,ne.value[u.id]=""})})}else t==="srt"&&setTimeout(async()=>{try{const A=await De(a.id);if(A.code!==0)throw new Error(A.message||"获取状态失败");const i=A.data.list;i[m].srt_status&&i[m].srt_status==="success"?(ne.value[a.id]=" 已完成",ve.value[a.id]=100,Re(()=>{const u=P.value.findIndex(U=>U.id===i[m].id);u!==-1&&(P.value[u]={...P.value[u],srt_file_id:i[m].srt_file_id??null,srt_file_path:i[m].srt_file_path??null})})):i[m].srt_status&&i[m].srt_status==="failed"?ne.value[a.id]=" 生成失败":await Be("srt",a,m)}catch(A){console.error(A)}},2e3)},pe=async()=>{try{const t={gender_condition:r.gender_condition,industry_condition:r.industry_condition,emotion_condition:r.emotion_condition,is_public:r.isShare},a=await Lt(t);if(a.code===0)le.value=!1,_.value=a.data.list,$.value=1,ee.value=[],await N();else throw new Error(a.data.message||"获取语音列表失败")}catch(t){throw d.error(t.message||"获取语音列表失败"),t}},We=async()=>{try{const t=await De(11);if(t.code===0){let a=t.data.list;P.value=a.map(m=>({id:m.id,audition_file_url:`${F}${m.file_url}`,text:m.text,status:m.status,industry:m.industry,emotion:m.emotion,name:m.name,gender:m.gender,create_time:m.create_time,srt_file_id:m.srt_file_id??null,srt_file_path:m.srt_file_path??null})),Re(()=>{P.value.forEach(m=>{se.value[m.id]=!1,ve.value[m.id]=0,ne.value[m.id]=""})})}else throw new Error(t.message)}catch(t){d.error(t)}},Ke=v(null);wt(()=>P.value.some(t=>t.status==="pending"),t=>{if(t&&(Ke.value=new Promise((a,m)=>{const A=setInterval(async()=>{try{const i=await De(11);if(i.code!==0)throw new Error(i.message||"获取状态失败");const u=i.data.list;let U=!0;P.value.filter(D=>D.status==="pending").map(D=>D.id).forEach(D=>{const I=u.find(n=>n.id===D);if(I)if(I.status==="success"){const n=P.value.findIndex(g=>g.id===D);n!==-1&&(P.value[n]={id:I.id,audition_file_url:`${F}${I.file_url}`,text:I.text,status:I.status,industry:I.industry,emotion:I.emotion,name:I.name,gender:I.gender,create_time:I.create_time,srt_file_id:I.srt_file_id??null,srt_file_path:I.srt_file_path??null},Re(()=>{se.value[D]=!1,ve.value[D]=0,ne.value[D]=""}))}else I.status==="pending"?U=!1:I.status==="failed"&&(clearInterval(A),ne.value[D]="生成失败")}),U&&(clearInterval(A),a())}catch(i){clearInterval(A),m(i)}},6e3)})),Ce.value.length>0)for(let a=Ce.value.length-1;a>=0;a--){const m=Ce.value[a],A=P.value.findIndex(u=>u.id===m),i=P.value.find(u=>u.id===m);i&&i.status==="success"&&(Ve(i,A),Ce.value.splice(a,1))}},{deep:!0});const Ve=async(t,a)=>{t.reCreate&&(t.reCreate=!1,ve.value[t.id]=0,ne.value[t.id]="生成中...");try{let m={id:t.id};const A=await Pt(m);if(A.code===0)se.value[t.id]=!0,ne.value[t.id]="生成中...",setTimeout(()=>{ve.value[t.id]=40},100),setTimeout(()=>{ve.value[t.id]=75},300),setTimeout(async()=>{await Be("srt",t,a)},500);else throw new Error(A.message)}catch(m){d.error("生成失败!",m)}},Ze=t=>{t.reCreate=!0},Xe=async t=>{oe.value=!0,L.value=t},Ye=async t=>{ie.value=!0,L.value=t},c=async t=>{Ie.confirm("确定要删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const a=await qt(t.id);if(a.code===0){let A=(await De(t.id)).data.list;P.value=P.value.filter(i=>A.some(u=>u.id===i.id)),A.forEach(i=>{const u=P.value.findIndex(U=>U.id===i.id);if(u!==-1){const U=P.value[u];Object.keys(i).some(D=>D!=="id"?i[D]!==U[D]:!1)&&(P.value[u]={id:i.id,audition_file_url:`${F}${i.file_url}`,text:i.text,status:i.status,industry:i.industry,emotion:i.emotion,name:i.name,gender:i.gender,create_time:i.create_time,srt_file_id:i.srt_file_id??null,srt_file_path:i.srt_file_path??null},Re(()=>{se.value[i.id]=!1,ve.value[i.id]=0,ne.value[i.id]=""}))}else P.value.push({id:i.id,audition_file_url:`${F}${i.file_url}`,text:i.text,status:i.status,industry:i.industry,emotion:i.emotion,name:i.name,gender:i.gender,create_time:i.create_time,srt_file_id:i.srt_file_id??null,srt_file_path:i.srt_file_path??null}),Re(()=>{se.value[i.id]=!1,ve.value[i.id]=0,ne.value[i.id]=""})}),d({type:"success",message:"删除成功!"})}else throw new Error(a.message)})},e=v(new Map),R=t=>{r.industry_condition=t,pe()},W=t=>{r.emotion_condition=t,pe()};return(t,a)=>{const m=gt,A=mt,i=$e,u=He,U=Qe,he=_t,D=rt("font-awesome-icon"),I=Ge;return we((p(),x("div",{"element-loading-text":Je.value,class:"voice-synthesis-container h-full w-full"},[s(A,{modelValue:X.value,"onUpdate:modelValue":a[0]||(a[0]=n=>X.value=n),class:"demo-tabs",onTabClick:Z},{default:o(()=>[s(m,{label:"语音合成",name:"speechHC"}),s(m,{label:"语音复刻",name:"speechFK"})]),_:1},8,["modelValue"]),X.value=="speechHC"?(p(),x("div",Ka,[l("div",Za,[l("div",Xa,[l("div",Ya,[a[12]||(a[12]=l("h1",{class:"voice-list-title"},"选择音色",-1)),l("div",es,[s(u,{modelValue:r.isShare,"onUpdate:modelValue":a[1]||(a[1]=n=>r.isShare=n),onChange:S},{default:o(()=>[s(i,{label:"公共语音库",value:!0},{default:o(()=>a[10]||(a[10]=[k("公共语音库")])),_:1,__:[10]}),s(i,{label:"私有语音库",value:!1},{default:o(()=>a[11]||(a[11]=[k("私有语音库")])),_:1,__:[11]})]),_:1},8,["modelValue"])])]),l("div",ts,[a[16]||(a[16]=l("span",{class:"filter-buttons-title"}," 性别:",-1)),l("div",as,[s(U,{size:"small",class:ye(["filter-button",{active:f.value===null}]),onClick:a[2]||(a[2]=n=>H(null))},{default:o(()=>a[13]||(a[13]=[k("全部")])),_:1,__:[13]},8,["class"]),s(U,{size:"small",class:ye(["filter-button",{active:f.value==="male"}]),onClick:a[3]||(a[3]=n=>H("male"))},{default:o(()=>a[14]||(a[14]=[k("男性")])),_:1,__:[14]},8,["class"]),s(U,{size:"small",class:ye(["filter-button",{active:f.value==="female"}]),onClick:a[4]||(a[4]=n=>H("female"))},{default:o(()=>a[15]||(a[15]=[k("女性")])),_:1,__:[15]},8,["class"])])]),l("div",ss,[a[18]||(a[18]=l("span",{class:"filter-buttons-title"}," 行业:",-1)),l("div",ls,[s(U,{size:"small",class:ye(["filter-button",{active:r.industry_condition===null}]),onClick:a[5]||(a[5]=n=>R(null))},{default:o(()=>a[17]||(a[17]=[k("全部")])),_:1,__:[17]},8,["class"]),(p(!0),x(ge,null,ke(y.industries,n=>(p(),K(U,{size:"small",class:ye(["filter-button",{active:r.industry_condition===n}]),key:n,onClick:g=>R(n)},{default:o(()=>[k(T(n),1)]),_:2},1032,["class","onClick"]))),128))])]),l("div",os,[a[20]||(a[20]=l("span",{class:"filter-buttons-title"}," 情绪:",-1)),l("div",ns,[s(U,{size:"small",class:ye(["filter-button",{active:r.emotion_condition===null}]),onClick:a[6]||(a[6]=n=>W(null))},{default:o(()=>a[19]||(a[19]=[k("全部")])),_:1,__:[19]},8,["class"]),(p(!0),x(ge,null,ke(y.emotions,n=>(p(),K(U,{size:"small",class:ye(["filter-button",{active:r.emotion_condition===n}]),key:n,onClick:g=>W(n)},{default:o(()=>[k(T(n),1)]),_:2},1032,["class","onClick"]))),128))])]),l("div",rs,[l("div",is,[(p(!0),x(ge,null,ke(ee.value,n=>(p(),x("div",{class:ye(["voice-item",{active:E.value&&E.value.id===n.id}]),key:n.id,onClick:g=>ue(n)},[n.status=="hot"&&r.isShare==!0?(p(),x("div",ds,"HOT")):n.status=="new"&&r.isShare==!0?(p(),x("div",cs,"NEW")):me("",!0),r.isShare==!1?(p(),x("div",{key:2,class:"edit-button",onClick:et(g=>be(n),["stop"])}," 编辑 ",8,fs)):me("",!0),l("img",{src:n.avatar,alt:n.name,class:"voice-avatar"},null,8,vs),l("div",ps,T(n.emotion)+"-"+T(n.name),1),E.value&&E.value.id===n.id?(p(),x("div",{key:3,class:"play-buttons",onClick:et(g=>Te(n.id),["stop"])},[Ne(n.id)?(p(),x("img",{key:0,src:G(Qt),alt:"pause"},null,8,ms)):(p(),x("img",{key:1,src:G(Gt),alt:"play"},null,8,gs))],8,_s)):me("",!0),l("audio",{ref_for:!0,ref:g=>fe.value[n.id]=g,src:n.audition_file_url,preload:"none",onEnded:g=>de(n.id)},null,40,hs)],10,us))),128))])])]),l("div",ys,[l("div",bs,[a[21]||(a[21]=l("h1",{class:"editor-title"},"语音合成",-1)),l("div",As,[s(u,{modelValue:b.language,"onUpdate:modelValue":a[7]||(a[7]=n=>b.language=n),placeholder:"请选择语种"},{default:o(()=>[s(i,{label:"中文",value:"中文"}),s(i,{label:"英文",value:"英文"}),s(i,{label:"日文",value:"日文"}),s(i,{label:"粤语",value:"粤语"}),s(i,{label:"中英混合",value:"中英混合"}),s(i,{label:"日英混合",value:"日英混合"}),s(i,{label:"粤英混合",value:"粤英混合"}),s(i,{label:"韩英混合",value:"韩英混合"}),s(i,{label:"多语种混合",value:"多语种混合"})]),_:1},8,["modelValue"])])]),l("div",ws,[a[22]||(a[22]=l("div",{class:"speed-label"},"语速调整",-1)),l("div",ks,[s(he,{modelValue:b.speed,"onUpdate:modelValue":a[8]||(a[8]=n=>b.speed=n),min:.6,max:1.65,step:.05},null,8,["modelValue"]),l("div",Es,T(b.speed),1)])]),l("div",xs,[l("div",Cs,[l("div",Rs,[s(D,{icon:"comment-dots"}),a[23]||(a[23]=k(" 输入要合成的语音文字 "))]),l("div",Ss,T(M.value)+" / 6000",1)]),we(l("textarea",{placeholder:"请输入文本进行语音合成...","onUpdate:modelValue":a[9]||(a[9]=n=>B.value=n),onInput:z},null,544),[[kt,B.value]])]),l("div",Ts,[l("button",{class:"action-button primary-button",onClick:xe},[s(D,{icon:"music"}),a[24]||(a[24]=k(" 生成音频 "))]),l("button",{class:"action-button secondary-button",onClick:Ae},[s(D,{icon:"closed-captioning"}),a[25]||(a[25]=k(" 生成音频和SRT "))])])]),l("div",Bs,[a[37]||(a[37]=l("div",{class:"task-list-header"},[l("h2",{class:"task-list-title"},[l("i",{class:"fas fa-tasks"}),k(" 合成语音列表 ")])],-1)),l("div",Vs,[P.value.length?(p(),x("div",Ds,[(p(!0),x(ge,null,ke(P.value,(n,g)=>(p(),x("div",{class:"task-group",key:g},[l("div",Fs,[l("div",Us,[l("div",Is,T(n.industry)+"-"+T(n.emotion)+"-"+T(n.name)+"-"+T(n.gender=="male"?"男":"女"),1),l("div",Ls,T(n.create_time),1)]),l("div",Os,[l("span",null,T(n.emotion)+"-"+T(n.name),1)])]),l("div",Ps,[n.status==="pending"?(p(),x("div",qs,[s(G(lt),{class:"is-loading"},{default:o(()=>[s(G(Et))]),_:1}),a[26]||(a[26]=k(" 语音生成中...... "))])):n.status==="success"?(p(),x("audio",{key:1,ref_for:!0,ref:Y=>fe.value[n.id]=Y,class:"task-preview",src:n.audition_file_url,controlsList:"nodownload",controls:"",onPlay:Y=>q(n.id),onEnded:Y=>de(n.id,"voice")},null,40,zs)):me("",!0),l("div",Hs,[l("div",$s,[l("div",{class:"dropdown-button",onClick:Y=>n.status==="success"?V(n):null,style:Fe({opacity:n.status==="success"?1:.5,cursor:n.status==="success"?"pointer":"not-allowed"})},[s(D,{icon:"download"}),a[27]||(a[27]=k(" 下载 "))],12,Qs),l("div",{class:ye(["dropdown-content",{show:Q.value[n.id]}])},[l("div",{class:"dropdown-item",onClick:Y=>h(n,"voice")},[s(D,{icon:"music"}),a[28]||(a[28]=l("span",null,"下载音频",-1))],8,Gs),n.srt_file_path&&n.srt_file_path!==""?(p(),x("div",{key:0,class:"dropdown-item",onClick:Y=>h(n,"srt")},[s(D,{icon:"file-alt"}),a[29]||(a[29]=l("span",null,"下载SRT",-1))],8,js)):me("",!0),n.srt_file_path&&n.srt_file_path!==""?(p(),x("div",{key:1,class:"dropdown-item",onClick:Y=>h(n,"all")},[s(D,{icon:"archive"}),a[30]||(a[30]=l("span",null,"下载全部",-1))],8,Ms)):me("",!0)],2)]),n.reCreate?(p(),x("div",{key:0,class:"task-action srt",onClick:Y=>Ve(n,g)},[s(D,{icon:"closed-captioning"}),a[31]||(a[31]=l("span",null,"重新生成SRT",-1))],8,Js)):!n.srt_file_path||n.srt_file_path==""?(p(),x("div",{key:1,class:ye(["task-action srt",{"srt-progress":se.value[n.id]}]),style:Fe({opacity:n.status==="success"?1:.5,cursor:n.status==="success"?"pointer":"not-allowed"}),onClick:Y=>n.status==="success"?Ve(n,g):null},[se.value[n.id]?(p(),x(ge,{key:0},[l("div",{class:"srt-progress-bar",style:Fe({width:ve.value[n.id]+"%"})},null,4),l("div",{class:"srt-progress-text",innerHTML:ne.value[n.id],onClick:et(Y=>{(ne.value[n.id]||"").trim()=="生成失败"&&Ze(n)},["stop"])},null,8,Ws)],64)):(p(),x(ge,{key:1},[s(D,{icon:"closed-captioning"}),a[32]||(a[32]=l("span",null,"生成SRT",-1))],64))],14,Ns)):(p(),x("div",{key:2,class:"task-action srt",onClick:Y=>Xe(n)},[s(D,{icon:"closed-captioning"}),a[33]||(a[33]=k(" 查看SRT "))],8,Ks)),l("div",{class:"task-action import",onClick:Y=>n.srt_file_path&&n.srt_file_path!==""?Ye(n):null,style:Fe({opacity:n.srt_file_path&&n.srt_file_path!==""?1:.5,cursor:n.srt_file_path&&n.srt_file_path!==""?"pointer":"not-allowed"})},[s(D,{icon:"file-import"}),a[34]||(a[34]=k(" 导入 "))],12,Zs),l("div",{class:"task-action delete",onClick:Y=>c(n)},[s(D,{icon:"trash-alt"}),a[35]||(a[35]=k(" 删除 "))],8,Xs)])])]))),128))])):(p(),x("div",Ys,a[36]||(a[36]=[l("p",null,"暂无合成语音。",-1)])))])])])])):(p(),x("div",el,[s(Na,{categories:y,onJumpToPerson:Pe},null,8,["categories"])])),j.value?(p(),K(Nt,{key:2,ref:"personEditRef",propdata:L.value,categories:y,onCloseDialog:Ee},null,8,["propdata","categories"])):me("",!0),ie.value?(p(),K(ua,{key:3,ref:"ToNovelRef",propdata:L.value,onCloseDialog:w},null,8,["propdata"])):me("",!0),oe.value?(p(),K(va,{key:4,ref:"SRTFileRef",propdata:L.value,onCloseDialog:je},null,8,["propdata"])):me("",!0)],8,Wa)),[[I,Me.value]])}}},hl=Le(tl,[["__scopeId","data-v-82417501"]]);export{hl as default};
//# sourceMappingURL=index-Det6Mjw3.js.map
