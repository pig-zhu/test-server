import{r as z,_ as Me,E as p,a as we,b as Ve,c as xe,d as Ce,e as Ue,f as De,g as ke,h as Ee,i as Ae,j as Se,k as ze}from"./index-D7mwCrnB.js";import{E as Le}from"./el-progress-CH5jXrIz.js";import{E as Re}from"./el-pagination-C-0ZFUJb.js";import{E as he}from"./el-date-picker-BVWuB4X7.js";import{g as Pe,P as Te,p as A,a as Ye,b as $e}from"./speech-CFoWz9ss.js";import{b2 as Fe,a4 as R,r as b,A as Ie,c as k,z as qe,q as C,s as V,N as m,S as t,Q as d,X as h,aK as Ge,ah as _,L as S,P as Ne}from"./vue-vendor-BgjGt3mC.js";import"./axios-xsH4HHeE.js";import"./lodash-BmZg10rb.js";import"./jszip-C7-yN4-L.js";import"./remark-CBsncvHK.js";import"./quill-BeGMbSWh.js";const Be=async()=>await z.get("/admin/llm_model_prompts"),Oe=async(y,M)=>await z.post(`/admin/llm_model_prompt/${y}`,M),je=async y=>await z.get("/admin/dashboard/generated",{params:y}),Qe=async y=>await z.get("/admin/dashboard/rmbg",{params:y}),Ke=async y=>await z.get("/admin/dashboard/tts",{params:y}),Xe=Fe("LLMModelPromptStore",{state:()=>({prompts:[]}),actions:{async getLLMModelPrompts(y){return Be().then(M=>{this.prompts=M.data.list})},async editLLMModelPrompt(y,M){return Oe(y,M)}}}),He={class:"w-full h-full p-10 overflow-y-auto"},Je={class:"date-filter-container mb-4"},We={class:"flex items-center mb-4"},Ze={class:"flex gap-8"},et={class:"stat-item"},tt={class:"stat-value"},at={class:"stat-item"},ot={class:"stat-value"},lt={class:"stat-item"},st={class:"stat-value"},dt=["src"],nt={key:0},rt={key:0},it={key:0},ut={key:0},pt={key:0},mt={class:"dialog-footer"},ct={__name:"Admin",setup(y){const M=Xe(),c=R({industry:"1",model_id:null,prompt:""}),o=R({industry:"",emotion:"",name:"",gender:"",avatar:null,modelAudio:null,gptModel:null,sovitsModel:null,referenceAudios:[],referenceText:""}),U=b(!1);Ie(()=>c.model_id,(a,e)=>{const i=F.value.find(r=>r.id===a);i?c.prompt=i.prompt:c.prompt=""});const Y=(a,e)=>{e?f.value.page_size=a:g.value.page_size=a,x(e,1,a)},$=(a,e)=>{X.value=a,e?x(e,a,f.value.page_size):x(e,a,g.value.page_size)},j=()=>{M.editLLMModelPrompt(c.model_id,c),p.success("提交成功")},Q=()=>{c.industry="1",c.model_id=null,c.prompt=""},F=k(()=>M.prompts),K=k(()=>F.value.map(a=>({value:a.id,label:a.name})));qe(()=>{M.getLLMModelPrompts().then(()=>{}),x(!0,1,20),x(!1,1,20)});const f=b([]),g=b([]),X=b(1);b(10);const P="/api/",x=async(a,e,i)=>{const r={is_public:a,page:e,page_size:i};try{const n=await Pe(r);if(n.code===0)a?(f.value=n.data.data,f.value.current_page=n.data.current_page,f.value.page_size=n.data.page_size,f.value.total_count=n.data.total_count):(g.value=n.data.data,g.value.current_page=n.data.current_page,g.value.page_size=n.data.page_size,g.value.total_count=n.data.total_count);else throw new Error(n.message||"获取音色列表失败")}catch(n){p.error(n.message||"获取音色列表失败")}},H=()=>{Object.assign(o,{industry:"",emotion:"",name:"",gender:"",avatar:null,modelAudio:null,gptModel:null,sovitsModel:null,referenceAudios:[],referenceText:""}),U.value=!0},L=b(null),I=a=>{Object.assign(o,{industry:a.industry||"",emotion:a.emotion||"",name:a.name||"",gender:a.gender||"",avatar:a.avatar_id?{url:`${P}${a.avatar}`,id:a.avatar_id}:null,modelAudio:a.model_audio_id?{id:a.model_audio_id}:null,gptModel:a.gpt_model_id?{id:a.gpt_model_id,name:a.gpt_model_name}:null,sovitsModel:a.sovits_model_id?{id:a.sovits_model_id,name:a.sovits_model_name}:null,referenceAudios:a.reference_audios?a.reference_audios.map(e=>({id:e.id,url:`${P}${e.url}`})):[],referenceText:a.reference_text||""}),o.soundModel=a==null?void 0:a.id,L.value=`${P}${a.avatar}`,U.value=!0},J=()=>{U.value=!1,T()},W=b(null),Z=b(null),ee=b(null),te=b(null),ae=b(null),oe=k(()=>o.modelAudio?[{uid:o.modelAudio.id,name:"模型试听音频",status:"done",url:o.modelAudio.url}]:[]),le=k(()=>o.gptModel?[{uid:o.gptModel.id,name:o.gptModel.name,status:"done",url:o.gptModel.url}]:[]),se=k(()=>o.sovitsModel?[{uid:o.sovitsModel.id,name:o.sovitsModel.name,status:"done",url:o.sovitsModel.url}]:[]);k(()=>o.referenceAudios.map(a=>({uid:a.id,name:`参考音频${a.id}`,status:"done",url:a.url})));const de=async()=>{try{await ce(),p.success("保存成功"),U.value=!1,await x()}catch{p.error("保存失败")}},ne=async a=>{const{file:e,onSuccess:i,onError:r}=a,n=new FormData;n.append("file",e);try{const s=await A(n);if(s.code===0)o.avatar={id:s.data.file_id},i(s.data,e),p.success("头像图片上传成功!");else throw new Error(s.message)}catch(s){r(s),p.error("头像图片上传失败!")}},re=(a,e)=>{L.value=URL.createObjectURL(e.raw)},ie=async a=>{const{file:e,onSuccess:i,onError:r}=a,n=new FormData;n.append("file",e);try{const s=await A(n);if(s.code===0)o.modelAudio={id:s.data.file_id,filename:e.name},i(s.data,e),p.success("音色模型试听音频上传成功!");else throw new Error(s.message)}catch(s){r(s),p.error("音色模型试听音频上传失败!")}},ue=async a=>{o.gptModel={};const{file:e,onSuccess:i,onError:r}=a,n=new FormData;n.append("file",e);try{const s=await A(n);if(s.code===0)o.gptModel={id:s.data.file_id,name:e.name},i(s.data,e),p.success("GPT模型上传成功!");else throw new Error(s.message)}catch(s){r(s),p.error("GPT模型上传失败!")}},pe=async a=>{o.sovitsModel={};const{file:e,onSuccess:i,onError:r}=a,n=new FormData;n.append("file",e);try{const s=await A(n);if(s.code===0)o.sovitsModel={id:s.data.file_id,name:e.name},i(s.data,e),p.success("SoVITS模型上传成功!");else throw new Error(s.message)}catch(s){r(s),p.error("SoVITS模型上传失败!")}},me=async a=>{const{file:e,onSuccess:i,onError:r}=a,n=new FormData;n.append("file",e);try{const s=await A(n);if(s.code===0)o.referenceAudios={id:s.data.file_id,name:e.name},i(s.data,e),p.success("参考音频上传成功!");else throw new Error(s.message)}catch(s){r(s),p.error("参考音频上传失败!")}},ce=async()=>{var e,i,r,n;const a={industry:o.industry,emotion:o.emotion,gender:o.gender,name:o.name,avatar_id:o.avatar.id,audition_file_id:((e=o.modelAudio)==null?void 0:e.id)||"",gpt_model_id:((i=o.gptModel)==null?void 0:i.id)||"",sovits_model_id:((r=o.sovitsModel)==null?void 0:r.id)||"",reference_voice_id:((n=o.referenceAudios)==null?void 0:n.id)||"",reference_voice_text:o.referenceText,sound_model_id:o.soundModel};o.soundModel&&o.soundModel!==""?await Ye(a):await $e(a),p.success("保存成功!"),T()},q=async a=>{await Te({soundId:a}),p.success("删除成功!"),T(),await x()},T=()=>{o.value={id:"",industry:"",emotion:"",gender:"",name:"",avatar:{id:"",url:""},modelAudio:{id:"",url:""},gptModel:{id:"",name:""},sovitsModel:{}}},v=R({startDate:"",endDate:""}),D=R({chatbotCount:0,imageCount:0,audioCount:0}),_e=async()=>{if(!v.startDate||!v.endDate){p.warning("请选择开始和结束时间");return}try{const[a,e,i]=await Promise.all([je({start_date:v.startDate,end_date:v.endDate}).catch(r=>({code:-1})),Qe({start_date:v.startDate,end_date:v.endDate}).catch(r=>({code:-1})),Ke({start_date:v.startDate,end_date:v.endDate}).catch(r=>({code:-1}))]);a.code===0&&(D.chatbotCount=a.data.list||0),e.code===0&&(D.imageCount=e.data.list||0),i.code===0&&(D.audioCount=i.data.list||0)}catch(a){console.error("查询失败:",a)}};return(a,e)=>{const i=he,r=we,n=De,s=Ue,fe=ke,G=Ve,u=Ee,N=xe,B=Re,O=Se,ge=Ae,ve=Ge("i-upload-filled"),ye=ze,E=Le,be=Ce;return V(),C("div",He,[m("div",Je,[m("div",We,[e[20]||(e[20]=m("span",{class:"mr-2"},"起:",-1)),t(i,{modelValue:v.startDate,"onUpdate:modelValue":e[0]||(e[0]=l=>v.startDate=l),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",locale:a.zhCn,class:"mr-4"},null,8,["modelValue","locale"]),e[21]||(e[21]=m("span",{class:"mr-2"},"止:",-1)),t(i,{modelValue:v.endDate,"onUpdate:modelValue":e[1]||(e[1]=l=>v.endDate=l),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",locale:a.zhCn,class:"mr-4"},null,8,["modelValue","locale"]),t(r,{type:"primary",onClick:_e},{default:d(()=>e[19]||(e[19]=[_("确定")])),_:1,__:[19]})]),m("div",Ze,[m("div",et,[e[22]||(e[22]=m("span",{class:"stat-label"},"智能聊本:",-1)),m("span",tt,h(D.chatbotCount),1)]),m("div",at,[e[23]||(e[23]=m("span",{class:"stat-label"},"图片处理:",-1)),m("span",ot,h(D.imageCount),1)]),m("div",lt,[e[24]||(e[24]=m("span",{class:"stat-label"},"语音合成:",-1)),m("span",st,h(D.audioCount),1)])])]),t(G,{model:c,"label-width":"80px",class:"search-form"},{default:d(()=>[t(s,{label:"Industry"},{default:d(()=>[t(n,{modelValue:c.industry,"onUpdate:modelValue":e[2]||(e[2]=l=>c.industry=l)},null,8,["modelValue"])]),_:1}),t(s,{label:"Name"},{default:d(()=>[t(fe,{modelValue:c.model_id,"onUpdate:modelValue":e[3]||(e[3]=l=>c.model_id=l),placeholder:"Select",options:K.value},null,8,["modelValue","options"])]),_:1}),t(s,{label:"Prompt"},{default:d(()=>[t(n,{autosize:{minRows:8,maxRows:30},type:"textarea",modelValue:c.prompt,"onUpdate:modelValue":e[4]||(e[4]=l=>c.prompt=l)},null,8,["modelValue"])]),_:1}),t(s,null,{default:d(()=>[t(r,{type:"primary",onClick:j},{default:d(()=>e[25]||(e[25]=[_("确定")])),_:1,__:[25]}),t(r,{onClick:Q},{default:d(()=>e[26]||(e[26]=[_("重置")])),_:1,__:[26]})]),_:1})]),_:1},8,["model"]),t(r,{class:"mb-[10px]",type:"success",onClick:H,style:{"margin-top":"20px"}},{default:d(()=>e[27]||(e[27]=[_("新建音色")])),_:1,__:[27]}),e[39]||(e[39]=m("div",{class:"publicSpeek"},"公共语音库 ",-1)),t(N,{data:f.value,style:{width:"100%"}},{default:d(()=>[t(u,{type:"index",label:"序号",width:"60"}),t(u,{prop:"industry",label:"行业"}),t(u,{prop:"emotion",label:"情绪"}),t(u,{prop:"name",label:"音色名称"}),t(u,{prop:"gender",label:"音色性別"}),t(u,{prop:"generate_count",label:"产出量"}),t(u,{prop:"generate_count",label:"产出排名"}),t(u,{prop:"generate_count",label:"创建时间"}),t(u,{prop:"created_by",label:"创建用戶"}),t(u,{label:"操作",width:"180"},{default:d(({row:l})=>[t(r,{type:"text",onClick:w=>I(l)},{default:d(()=>e[28]||(e[28]=[_("编辑")])),_:2,__:[28]},1032,["onClick"]),t(r,{type:"text",onClick:w=>q(l.id)},{default:d(()=>e[29]||(e[29]=[_("删除")])),_:2,__:[29]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),t(B,{class:"page-style","current-page":f.value.current_page,"onUpdate:currentPage":e[5]||(e[5]=l=>f.value.current_page=l),"page-size":f.value.page_size,"onUpdate:pageSize":e[6]||(e[6]=l=>f.value.page_size=l),"page-sizes":[10,20,30,40],layout:"sizes, prev, pager, next",total:f.value.total_count,onSizeChange:e[7]||(e[7]=l=>Y(l,!0)),onCurrentChange:e[8]||(e[8]=l=>$(l,!0))},null,8,["current-page","page-size","total"]),e[40]||(e[40]=m("div",{class:"publicSpeek"},"私有语音库 ",-1)),t(N,{data:g.value,style:{width:"100%"}},{default:d(()=>[t(u,{type:"index",label:"序号",width:"60"}),t(u,{prop:"industry",label:"行业"}),t(u,{prop:"emotion",label:"情绪"}),t(u,{prop:"name",label:"音色名称"}),t(u,{prop:"gender",label:"音色性別"}),t(u,{prop:"generate_count",label:"产出量"}),t(u,{prop:"generate_count",label:"产出排名"}),t(u,{prop:"generate_count",label:"创建时间"}),t(u,{prop:"created_by",label:"创建用戶"}),t(u,{label:"操作",width:"180"},{default:d(({row:l})=>[t(r,{type:"text",onClick:w=>I(l)},{default:d(()=>e[30]||(e[30]=[_("编辑")])),_:2,__:[30]},1032,["onClick"]),t(r,{type:"text",onClick:w=>q(l.id)},{default:d(()=>e[31]||(e[31]=[_("删除")])),_:2,__:[31]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),t(B,{class:"page-style","current-page":g.value.current_page,"onUpdate:currentPage":e[9]||(e[9]=l=>g.value.current_page=l),"page-size":g.value.page_size,"onUpdate:pageSize":e[10]||(e[10]=l=>g.value.page_size=l),"page-sizes":[10,20,30,40],layout:"sizes, prev, pager, next",total:g.value.total_count,onSizeChange:e[11]||(e[11]=l=>Y(l,!1)),onCurrentChange:e[12]||(e[12]=l=>$(l,!1))},null,8,["current-page","page-size","total"]),t(be,{title:"编辑音色",modelValue:U.value,"onUpdate:modelValue":e[18]||(e[18]=l=>U.value=l)},{footer:d(()=>[m("div",mt,[t(r,{onClick:J},{default:d(()=>e[37]||(e[37]=[_("取消")])),_:1,__:[37]}),t(r,{type:"primary",onClick:de},{default:d(()=>e[38]||(e[38]=[_("上传并保存")])),_:1,__:[38]})])]),default:d(()=>[t(G,{model:o,"label-width":"150px"},{default:d(()=>[t(s,{label:"行业"},{default:d(()=>[t(n,{modelValue:o.industry,"onUpdate:modelValue":e[13]||(e[13]=l=>o.industry=l),placeholder:"请输入行业"},null,8,["modelValue"])]),_:1}),t(s,{label:"情绪"},{default:d(()=>[t(n,{modelValue:o.emotion,"onUpdate:modelValue":e[14]||(e[14]=l=>o.emotion=l),placeholder:"请输入情绪"},null,8,["modelValue"])]),_:1}),t(s,{label:"音色名称"},{default:d(()=>[t(n,{modelValue:o.name,"onUpdate:modelValue":e[15]||(e[15]=l=>o.name=l),placeholder:"请输入音色名称"},null,8,["modelValue"])]),_:1}),t(s,{label:"音色性别"},{default:d(()=>[t(ge,{modelValue:o.gender,"onUpdate:modelValue":e[16]||(e[16]=l=>o.gender=l),placeholder:"选择性别"},{default:d(()=>[t(O,{label:"男",value:"male"}),t(O,{label:"女",value:"female"})]),_:1},8,["modelValue"])]),_:1}),t(s,{label:"上传头像图片"},{default:d(()=>{var l;return[t(E,{class:"avatar-uploader",action:"/api/file/upload",ref_key:"avatarUploadRef",ref:W,"show-file-list":!1,"http-request":ne,"on-success":re},{default:d(()=>[L.value?(V(),C("img",{key:0,src:L.value,class:"avatar w-[170px] h-[170px]"},null,8,dt)):(V(),Ne(ye,{key:1,class:"avatar-uploader-icon"},{default:d(()=>[t(ve)]),_:1})),t(r,{type:"text"},{default:d(()=>e[32]||(e[32]=[_("上传")])),_:1,__:[32]})]),_:1},512),(l=o.avatar)!=null&&l.id?(V(),C("div",nt,"已上传")):S("",!0)]}),_:1}),t(s,{label:"音色模型试听音频"},{default:d(()=>{var l;return[t(E,{class:"upload-model-audio",action:"/api/file/upload",ref_key:"modelAudioUploadRef",ref:Z,"file-list":oe.value,"http-request":ie,"list-type":"text"},{default:d(()=>[t(r,{type:"text"},{default:d(()=>e[33]||(e[33]=[_("上传音频")])),_:1,__:[33]})]),_:1},8,["file-list"]),(l=o.modelAudio)!=null&&l.id?(V(),C("div",rt,"已上传")):S("",!0)]}),_:1}),t(s,{label:"GPT模型"},{default:d(()=>{var l,w;return[t(E,{class:"upload-gpt-model",action:"/api/file/upload",ref_key:"gptModelUploadRef",ref:ee,"file-list":le.value,"http-request":ue,"list-type":"text"},{default:d(()=>[t(r,{type:"text"},{default:d(()=>e[34]||(e[34]=[_("上传模型")])),_:1,__:[34]})]),_:1},8,["file-list"]),(l=o.gptModel)!=null&&l.id&&!((w=o.gptModel)!=null&&w.name)?(V(),C("div",it,"已上传")):S("",!0)]}),_:1}),t(s,{label:"SoVITS模型"},{default:d(()=>{var l,w;return[t(E,{class:"upload-sovits-model",action:"/api/file/upload",ref_key:"sovitsModelUploadRef",ref:te,"file-list":se.value,"http-request":pe,"list-type":"text"},{default:d(()=>[t(r,{type:"text"},{default:d(()=>e[35]||(e[35]=[_("上传模型")])),_:1,__:[35]})]),_:1},8,["file-list"]),(l=o.sovitsModel)!=null&&l.id&&!((w=o.sovitsModel)!=null&&w.name)?(V(),C("div",ut,"已上传")):S("",!0)]}),_:1}),t(s,{label:"参考音频"},{default:d(()=>[t(E,{class:"upload-reference-audio",action:"/api/file/upload",ref_key:"referenceAudiosUploadRef",ref:ae,"http-request":me,"list-type":"text"},{default:d(()=>[t(r,{type:"text"},{default:d(()=>e[36]||(e[36]=[_("上传音频")])),_:1,__:[36]})]),_:1},512),o.referenceAudios.length?(V(),C("div",pt," 已上传 "+h(o.referenceAudios.length)+" 个文件 ",1)):S("",!0)]),_:1}),t(s,{label:"参考音频文本"},{default:d(()=>[t(n,{type:"textarea",modelValue:o.referenceText,"onUpdate:modelValue":e[17]||(e[17]=l=>o.referenceText=l),placeholder:"请输入参考音频文本",rows:"4",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ut=Me(ct,[["__scopeId","data-v-f761cacc"]]);export{Ut as default};
//# sourceMappingURL=Admin-xup5nIJc.js.map
